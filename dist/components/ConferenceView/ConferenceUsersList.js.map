{"version":3,"file":"ConferenceUsersList.js","sources":["../../../src/components/ConferenceView/ConferenceUsersList.tsx"],"sourcesContent":["// Copyright (C) 2024 Nethesis S.r.l.\n// SPDX-License-Identifier: AGPL-3.0-or-later\n\nimport React, { type FC } from 'react'\nimport { useSelector, useDispatch } from 'react-redux'\nimport { RootState } from '../../store'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport {\n  faMicrophone,\n  faMicrophoneSlash,\n  faPause,\n  faTrash,\n} from '@fortawesome/free-solid-svg-icons'\nimport { Button } from '../Button'\nimport { useTranslation } from 'react-i18next'\nimport { CustomThemedTooltip } from '../CustomThemedTooltip'\nimport Timer from '../CallView/Timer'\nimport { muteUserConference, removeUserConference } from '../../lib/phone/call'\n\nexport interface ConferenceUsersListProps {}\n\nexport const ConferenceUsersList: FC<ConferenceUsersListProps> = ({}) => {\n  const { usersList } = useSelector((state: RootState) => state.conference)\n  const { isOwnerInside, conferenceId } = useSelector((state: RootState) => state.conference)\n  const dispatch = useDispatch()\n\n  const { avatars } = useSelector((state: RootState) => state.avatars)\n  const { extensions } = useSelector((state: RootState) => state.users)\n  const { t } = useTranslation()\n\n  // Get user avatar URL\n  const getAvatarUrl = (username: string | undefined): string | null => {\n    if (!username || !avatars) return null\n\n    // Try through extensions\n    if (extensions && extensions[username]?.username && avatars[extensions[username].username]) {\n      return `${avatars[extensions[username].username]}`\n    }\n\n    return null\n  }\n\n  // Generate initials from name\n  const generateInitials = (name: string | undefined, username: string | undefined): string => {\n    if (name) {\n      return name\n        .split(' ')\n        .map((n: string) => n[0])\n        .join('')\n        .toUpperCase()\n        .slice(0, 2)\n    } else if (username) {\n      return username.substring(0, 2).toUpperCase()\n    }\n    return '??'\n  }\n\n  const handleMuteParticipant = (userId: string, extensionId, isAlreadyMuted) => {\n    dispatch.conference.toggleUserMuted({ extenId: extensionId })\n    muteUserConference(conferenceId, userId, isAlreadyMuted)\n  }\n\n  const handleRemoveParticipant = (extenId: string) => {\n    removeUserConference(conferenceId, extenId)\n  }\n\n  const UserAvatar = ({ user }: { user: any }) => (\n    <div className='pi-inline-flex pi-items-center pi-justify-center pi-w-8 pi-h-8 pi-rounded-full pi-bg-gray-500'>\n      {getAvatarUrl(user.extenId) ? (\n        <div\n          className='pi-rounded-full pi-w-8 pi-h-8'\n          style={{\n            backgroundImage: `url(${getAvatarUrl(user?.extenId)})`,\n            backgroundRepeat: 'no-repeat',\n            backgroundSize: 'contain',\n            backgroundPosition: 'center',\n          }}\n        />\n      ) : (\n        <span className='pi-text-sm pi-font-medium pi-text-white'>\n          {generateInitials(user?.name, user?.extenId)}\n        </span>\n      )}\n    </div>\n  )\n\n  return (\n    <>\n      <div\n        className={`${\n          isOwnerInside ? '' : 'pi-space-y-1'\n        } pi-flex pi-flex-col pi-mt-2 pi-h-32 pi-overflow-y-auto pi-scrollbar-thin pi-scrollbar-thumb-gray-400 pi-dark:scrollbar-thumb-gray-400 pi-scrollbar-thumb-rounded-full pi-scrollbar-thumb-opacity-50 dark:pi-scrollbar-track-gray-900 pi-scrollbar-track-gray-200 pi-dark:scrollbar-track-gray-900 pi-scrollbar-track-rounded-full pi-scrollbar-track-opacity-25`}\n      >\n        {usersList && Object.values(usersList).filter((user) => !user?.owner).length > 0 ? (\n          Object?.values(usersList)\n            ?.filter((user) => !user?.owner)\n            ?.map((user) => (\n              <div\n                key={`${user?.id}-${user?.extenId}`}\n                className={`${\n                  isOwnerInside ? '' : 'pi-py-1'\n                } pi-flex pi-items-center pi-justify-between pi-px-3 pi-rounded-lg`}\n              >\n                <div className='pi-flex pi-items-center pi-gap-3 pi-truncate'>\n                  <UserAvatar user={user} />\n                  <span className='pi-font-medium pi-text-sm pi-text-gray-700 dark:pi-text-gray-200 pi-truncate pi-w-32'>\n                    {user?.name || user?.extenId}\n                  </span>\n                </div>\n                {isOwnerInside ? (\n                  <>\n                    <Button\n                      variant='transparent'\n                      data-tooltip-id='conference-user-mute'\n                      data-tooltip-content={\n                        user?.muted\n                          ? t('Conference.Unmute participant')\n                          : t('Conference.Mute participant')\n                      }\n                      onClick={() => handleMuteParticipant(user?.id, user?.extenId, user?.muted)}\n                    >\n                      <FontAwesomeIcon\n                        className={`pi-h-4 pi-w-4 ${\n                          user?.muted ? 'pi-text-red-500' : 'pi-text-gray-600 dark:pi-text-gray-300'\n                        }`}\n                        icon={user?.muted ? faMicrophoneSlash : faMicrophone}\n                      />\n                    </Button>\n                    <Button\n                      variant='transparent'\n                      data-tooltip-id='conference-user-remove'\n                      data-tooltip-content={t('Conference.Remove participant')}\n                      onClick={() => handleRemoveParticipant(user?.extenId)}\n                    >\n                      <FontAwesomeIcon\n                        className='pi-h-4 pi-w-4 pi-text-gray-600 dark:pi-text-gray-300'\n                        icon={faTrash}\n                      />\n                    </Button>\n                  </>\n                ) : (\n                  <>\n                    <FontAwesomeIcon\n                      className='pi-h-5 pi-w-5 pi-text-gray-600 dark:pi-text-gray-300'\n                      icon={user.muted ? faMicrophoneSlash : faPause}\n                    />\n                    <Timer\n                      size='small'\n                      startTime={String(\n                        Math?.floor(\n                          user?.joinTime !== null && user?.joinTime ? user?.joinTime / 1000 : 0,\n                        ),\n                      )}\n                      isNotAlwaysWhite\n                      isInsideConference\n                    />\n                  </>\n                )}\n              </div>\n            ))\n        ) : (\n          <div className='pi-flex pi-flex-col pi-justify-center pi-items-center pi-h-20 pi-text-gray-500 dark:pi-text-gray-400'>\n            <span>{t('Conference.No participants')}</span>\n            <span className='pi-text-xs pi-mt-1'>\n              {t('Conference.Add participants to conference')}\n            </span>\n          </div>\n        )}\n      </div>\n      <CustomThemedTooltip className='pi-z-1000' id='conference-user-remove' place='left' />\n      <CustomThemedTooltip className='pi-z-1000' id='conference-user-mute' place='left' />\n    </>\n  )\n}\n\nexport default ConferenceUsersList\n"],"names":["ConferenceUsersList","_a","usersList","useSelector","state","conference","_d","isOwnerInside","conferenceId","dispatch","useDispatch","avatars","extensions","users","t","useTranslation","getAvatarUrl","username","concat","UserAvatar","name","user","React","className","extenId","createElement","style","backgroundImage","backgroundRepeat","backgroundSize","backgroundPosition","split","map","n","join","toUpperCase","slice","substring","Fragment","Object","values","filter","owner","length","_c","_b","key","id","Button","variant","muted","onClick","userId","extensionId","isAlreadyMuted","toggleUserMuted","muteUserConference","FontAwesomeIcon","icon","faMicrophoneSlash","faMicrophone","removeUserConference","faTrash","faPause","Timer","size","startTime","String","Math","floor","joinTime","isNotAlwaysWhite","isInsideConference","CustomThemedTooltip","place"],"mappings":"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"}