{"version":3,"file":"index.js","sources":["../../../src/components/ConferenceView/index.tsx"],"sourcesContent":["// Copyright (C) 2024 Nethesis S.r.l.\n// SPDX-License-Identifier: AGPL-3.0-or-later\n\nimport React, { type FC } from 'react'\nimport { useSelector, useDispatch } from 'react-redux'\nimport { RootState, Dispatch } from '../../store'\nimport { useTranslation } from 'react-i18next'\nimport Hangup from '../Hangup'\nimport ConferenceUsersList from './ConferenceUsersList'\nimport { Button } from '../Button'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport {\n  faArrowRightToBracket,\n  faMicrophone,\n  faMicrophoneSlash,\n  faUserPlus,\n  faUsers,\n} from '@fortawesome/free-solid-svg-icons'\nimport { eventDispatch } from '../../utils'\nimport Timer from '../CallView/Timer'\nimport { joinConference, muteAllUsersConference } from '../../lib/phone/call'\nimport { CustomThemedTooltip } from '../CustomThemedTooltip'\nimport { AudioBars } from '../AudioBars'\nimport AvatarGroup from '../AvatarGroup'\n\nexport const WaitingConferenceView: FC<WaitingConferenceViewProps> = () => {\n  const { isOwnerInside, isConferenceMuted, conferenceStartTime, conferenceId, usersList } =\n    useSelector((state: RootState) => state.conference)\n  const { view, sideViewIsVisible, isOpen } = useSelector((state: RootState) => state.island)\n  const { remoteAudioStream } = useSelector((state: RootState) => state.webrtc)\n  const { paused } = useSelector((state: RootState) => state.currentCall)\n  const { t } = useTranslation()\n  const dispatch = useDispatch<Dispatch>()\n\n  const handleMuteParticipant = () => {\n    if (conferenceId) {\n      muteAllUsersConference(conferenceId, isConferenceMuted)\n      dispatch.conference.toggleIsConferenceMuted(!isConferenceMuted)\n    }\n  }\n\n  const openAddUserListToAddConference = () => {\n    // Update island store and set conference list view to true\n    dispatch.island.toggleConferenceList(true)\n    // Set the island view to transfer list\n    dispatch.island.setIslandView(view !== 'transfer' ? 'transfer' : 'call')\n    // Check if sideView is visible and close it\n    if (sideViewIsVisible) {\n      eventDispatch('phone-island-sideview-close', {})\n    }\n    eventDispatch('phone-island-call-conference-list-opened', {})\n  }\n\n  const joinOwnerToConference = () => {\n    dispatch.conference.toggleIsOwnerInside(true)\n    setTimeout(() => {\n      joinConference()\n    }, 800)\n  }\n\n  return (\n    <>\n      {isOpen ? (\n        <>\n          <div className='pi-flex pi-flex-col pi-w-full'>\n            {/* Header */}\n            <div className='pi-flex pi-items-center pi-justify-between pi-text-gray-900 dark:pi-text-gray-50'>\n              <h1 className='pi-text-lg pi-font-medium pi-leading-7 pi-w-full'>\n                {isOwnerInside\n                  ? t('Conference.Conference')\n                  : t('Conference.Waiting for the conference')}\n              </h1>\n              {isOwnerInside && (\n                <Timer\n                  size='small'\n                  startTime={String(Math?.floor(conferenceStartTime / 1000))}\n                  isNotAlwaysWhite\n                  isInsideConference\n                />\n              )}\n            </div>\n\n            {/* User waiting list */}\n            <ConferenceUsersList />\n            <div className='pi-flex pi-justify-center pi-space-x-6 pi-mt-4'>\n              {!isOwnerInside ? (\n                <>\n                  <Button\n                    variant='default'\n                    className='pi-w-52 pi-font-medium pi-leading-5'\n                    conference\n                    onClick={() => joinOwnerToConference()}\n                  >\n                    <FontAwesomeIcon icon={faArrowRightToBracket} className='pi-mr-3' />\n                    {t('Conference.Start conference')}\n                  </Button>\n                  <Button\n                    variant='default'\n                    conference\n                    onClick={() => openAddUserListToAddConference()}\n                    data-tooltip-id='tooltip-add-user-to-conference-before-started'\n                    data-tooltip-content={t('Conference.Add participant') || ''}\n                    className='pi-font-medium'\n                  >\n                    <FontAwesomeIcon icon={faUserPlus} />\n                  </Button>\n                </>\n              ) : (\n                <>\n                  <Button\n                    variant='default'\n                    active={isConferenceMuted ? true : false}\n                    onClick={() => handleMuteParticipant()}\n                    data-tooltip-id='tooltip-all-user-muted'\n                    data-tooltip-content={\n                      isConferenceMuted\n                        ? `${t('Conference.Unmute all participants')}`\n                        : `${t('Conference.Mute all participants')}`\n                    }\n                  >\n                    {isConferenceMuted ? (\n                      <FontAwesomeIcon className='pi-h-6 pi-w-6' icon={faMicrophoneSlash} />\n                    ) : (\n                      <FontAwesomeIcon className='pi-h-6 pi-w-6' icon={faMicrophone} />\n                    )}\n                  </Button>\n                  <Button\n                    data-stop-propagation={true}\n                    variant='default'\n                    onClick={() => openAddUserListToAddConference()}\n                    data-tooltip-id='tooltip-add-user-to-conference'\n                    data-tooltip-content={t('Conference.Add participant') || ''}\n                  >\n                    <FontAwesomeIcon icon={faUserPlus} className='pi-h-6 pi-w-6' />\n                  </Button>\n                </>\n              )}\n            </div>\n          </div>\n          <div className={`pi-absolute pi-bottom-4 pi-right-0 pi-w-full pi-pb-2`}>\n            <Hangup />\n          </div>\n          <CustomThemedTooltip\n            className='pi-z-1000'\n            id='tooltip-add-user-to-conference'\n            place='top'\n          />\n          <CustomThemedTooltip\n            className='pi-z-1000'\n            id='tooltip-add-user-to-conference-before-started'\n            place='left'\n          />\n          <CustomThemedTooltip className='pi-z-1000' id='tooltip-all-user-muted' place='top' />\n        </>\n      ) : (\n        <div className='pi-flex-col'>\n          <div className='pi-flex pi-items-center pi-justify-between pi-space-x-1'>\n            <FontAwesomeIcon icon={faUsers} className='pi-h-4 pi-w-4' />\n            <Timer\n              size='small'\n              startTime={String(Math?.floor(conferenceStartTime / 1000))}\n              isNotAlwaysWhite\n              isInsideConference\n            />\n            <AudioBars\n              audioStream={remoteAudioStream}\n              paused={paused}\n              size={isOpen ? 'large' : 'small'}\n            />\n          </div>\n          <div className='pi-flex pi-justify-center pi-items-center pi-pt-1'>\n            <AvatarGroup usersList={usersList || {}} maxAvatars={5} />\n          </div>\n        </div>\n      )}\n    </>\n  )\n}\n\nexport interface WaitingConferenceViewProps {}\n"],"names":["_a","useSelector","state","conference","isOwnerInside","isConferenceMuted","conferenceStartTime","conferenceId","usersList","_b","island","view","sideViewIsVisible","isOpen","remoteAudioStream","webrtc","paused","currentCall","t","useTranslation","dispatch","useDispatch","openAddUserListToAddConference","toggleConferenceList","setIslandView","eventDispatch","React","createElement","Fragment","className","Timer","size","startTime","String","Math","floor","isNotAlwaysWhite","isInsideConference","ConferenceUsersList","Button","variant","active","onClick","muteAllUsersConference","toggleIsConferenceMuted","concat","FontAwesomeIcon","icon","faMicrophoneSlash","faMicrophone","faUserPlus","toggleIsOwnerInside","setTimeout","joinConference","faArrowRightToBracket","Hangup","CustomThemedTooltip","id","place","faUsers","AudioBars","audioStream","AvatarGroup","maxAvatars"],"mappings":"k4CAyBqE,WAC7D,IAAAA,EACJC,EAAAA,aAAY,SAACC,GAAqB,OAAAA,EAAMC,UAAU,IAD5CC,EAAaJ,EAAAI,cAAEC,EAAiBL,EAAAK,kBAAEC,EAAmBN,EAAAM,oBAAEC,EAAYP,EAAAO,aAAEC,EAASR,EAAAQ,UAEhFC,EAAsCR,EAAAA,aAAY,SAACC,GAAqB,OAAAA,EAAMQ,UAA5EC,EAAIF,EAAAE,KAAEC,EAAiBH,EAAAG,kBAAEC,EAAMJ,EAAAI,OAC/BC,EAAsBb,eAAY,SAACC,GAAqB,OAAAA,EAAMa,4BAC9DC,EAAWf,eAAY,SAACC,GAAqB,OAAAA,EAAMe,sBACnDC,EAAMC,qBACRC,EAAWC,EAAAA,cASXC,EAAiC,WAErCF,EAASV,OAAOa,sBAAqB,GAErCH,EAASV,OAAOc,cAAuB,aAATb,EAAsB,WAAa,QAE7DC,GACFa,gBAAc,8BAA+B,CAAA,GAE/CA,gBAAc,2CAA4C,CAAA,EAC5D,EASA,OACEC,UACGC,cAAAD,EAAA,QAAAE,SAAA,KAAAf,EACCa,UAAAC,cAAAD,EAAA,QAAAE,SAAA,KACEF,EAAAA,QAAKC,cAAA,MAAA,CAAAE,UAAU,iCAEbH,EAAAA,QAAKC,cAAA,MAAA,CAAAE,UAAU,oFACbH,EAAA,QAAAC,cAAA,KAAA,CAAIE,UAAU,oDAERX,EADHd,EACK,wBACA,0CAEPA,GACCsB,EAAC,QAAAC,cAAAG,EAAAA,SACCC,KAAK,QACLC,UAAWC,OAAO,OAAAC,WAAA,IAAAA,UAAA,EAAAA,KAAMC,MAAM7B,EAAsB,MACpD8B,kBAAgB,EAChBC,oBAAkB,KAMxBX,UAAAC,cAACW,EAAmBA,oBAAG,MACvBZ,EAAAA,QAAKC,cAAA,MAAA,CAAAE,UAAU,kDACXzB,EAuBAsB,EAAAA,QAAAC,cAAAD,EAAA,QAAAE,SAAA,KACEF,EAAA,QAAAC,cAACY,SAAM,CACLC,QAAQ,UACRC,SAAQpC,EACRqC,QAAS,WA7ErBnC,IACFoC,yBAAuBpC,EAAcF,GACrCe,EAASjB,WAAWyC,yBAAyBvC,GA2EO,EACtB,kBAAA,gDAGV,GAAGwC,OAAA3B,EADPb,EACS,qCACA,sCAGVA,EACCqB,UAAAC,cAACmB,EAAeA,gBAAC,CAAAjB,UAAU,gBAAgBkB,KAAMC,sBAEjDtB,EAAC,QAAAC,cAAAmB,EAAeA,iBAACjB,UAAU,gBAAgBkB,KAAME,EAAYA,gBAGjEvB,UAACC,cAAAY,EAAAA,OACwB,CAAA,yBAAA,EACvBC,QAAQ,UACRE,QAAS,WAAM,OAAApB,GAAgC,EAAA,kBAC/B,iCAAgC,uBAC1BJ,EAAE,+BAAiC,IAEzDQ,EAAAA,QAAAC,cAACmB,kBAAe,CAACC,KAAMG,EAAAA,WAAYrB,UAAU,oBA/CjDH,EAAAA,QAAAC,cAAAD,EAAA,QAAAE,SAAA,KACEF,EAAA,QAAAC,cAACY,EAAMA,OACL,CAAAC,QAAQ,UACRX,UAAU,sCACV1B,YAAU,EACVuC,QAAS,WAAM,OArC/BtB,EAASjB,WAAWgD,qBAAoB,QACxCC,YAAW,WACTC,EAAAA,gBACD,GAAE,OAoCa3B,EAAC,QAAAC,cAAAmB,mBAAgBC,KAAMO,wBAAuBzB,UAAU,YACvDX,EAAE,gCAELQ,UAAAC,cAACY,EAAMA,OAAA,CACLC,QAAQ,UACRrC,YAAU,EACVuC,QAAS,WAAM,OAAApB,GAAgC,EAC/B,kBAAA,gDACM,uBAAAJ,EAAE,+BAAiC,GACzDW,UAAU,kBAEVH,EAAAA,QAAAC,cAACmB,kBAAe,CAACC,KAAMG,EAAUA,iBAmC3CxB,EAAAA,QAAKC,cAAA,MAAA,CAAAE,UAAW,wDACdH,EAAAA,QAACC,cAAA4B,iBAEH7B,UAAAC,cAAC6B,EAAmBA,oBAAA,CAClB3B,UAAU,YACV4B,GAAG,iCACHC,MAAM,QAERhC,UAAAC,cAAC6B,EAAmBA,oBAAA,CAClB3B,UAAU,YACV4B,GAAG,gDACHC,MAAM,SAERhC,EAAC,QAAAC,cAAA6B,uBAAoB3B,UAAU,YAAY4B,GAAG,yBAAyBC,MAAM,SAG/EhC,UAAAC,cAAA,MAAA,CAAKE,UAAU,eACbH,EAAAA,QAAKC,cAAA,MAAA,CAAAE,UAAU,2DACbH,EAAC,QAAAC,cAAAmB,mBAAgBC,KAAMY,UAAS9B,UAAU,kBAC1CH,EAAAA,QAACC,cAAAG,UACC,CAAAC,KAAK,QACLC,UAAWC,OAAO,OAAAC,WAAA,IAAAA,UAAA,EAAAA,KAAMC,MAAM7B,EAAsB,MACpD8B,kBACA,EAAAC,oBACA,IACFX,EAAAA,QAACC,cAAAiC,EAAAA,WACCC,YAAa/C,EACbE,OAAQA,EACRe,KAAMlB,EAAS,QAAU,WAG7Ba,EAAAA,QAAKC,cAAA,MAAA,CAAAE,UAAU,qDACbH,EAAAA,QAAAC,cAACmC,UAAY,CAAAtD,UAAWA,GAAa,GAAIuD,WAAY,MAMjE"}