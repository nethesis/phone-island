"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../../node_modules/tslib/tslib.es6.js"),t=require("react"),a=require("../Button.js");require("../../node_modules/react-redux/es/index.js");var i=require("../../node_modules/@fortawesome/react-fontawesome/index.es.js"),r=require("../../lib/island/island.js"),n=require("../../node_modules/@fortawesome/free-solid-svg-icons/index.mjs.js"),l=require("../../lib/phone/call.js");require("../../node_modules/@babel/runtime/helpers/defineProperty.js"),require("../../node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),require("../../node_modules/@babel/runtime/helpers/typeof.js"),require("../../node_modules/html-parse-stringify/dist/html-parse-stringify.js"),require("../../node_modules/react-i18next/dist/es/context.js");var o=require("../../node_modules/react-i18next/dist/es/useTranslation.js");require("../../node_modules/@babel/runtime/helpers/slicedToArray.js");var s=require("../../utils/customHooks/useEventListener.js"),c=require("../../utils/genericFunctions/eventDispatch.js");require("../../store/index.js");var u=require("../CustomThemedTooltip.js"),d=require("../../services/phonebook.js"),p=require("./SelectContactNumberView.js"),m=require("../../node_modules/lodash/debounce.js"),f=require("./ListAvatar.js"),v=require("../../node_modules/react-redux/es/hooks/useSelector.js"),g=require("../../node_modules/react-redux/es/hooks/useDispatch.js");function h(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var b=h(t);exports.ContactListView=function(){var h=v.useSelector((function(e){return e.island})),x=h.isOpen,E=h.contactListView,y=v.useSelector((function(e){return e.users})).endpoints,N=v.useSelector((function(e){return e.currentUser})).username,w=t.useState(!1),k=w[0],j=w[1],C=t.useState([]),T=C[0],_=C[1],q=t.useState([]),P=q[0],L=q[1],S=t.useState(),A=S[0],I=S[1],F=t.useState(!0),B=F[0],H=F[1],z=t.useState(""),O=z[0],V=z[1],D=t.useState(),M=D[0],R=D[1],U=t.useRef(null),W=t.useState(!1),$=W[0],G=W[1],J=t.useState(10),K=J[0],Q=J[1],X=g.useDispatch(),Y=t.useMemo((function(){return e.__spreadArray(e.__spreadArray([],T,!0),P,!0)}),[T,P]),Z=t.useRef(m.default((function(e){te(e)}),300)).current;function ee(e){if(void 0===e&&(e=""),e=e.trim().toLowerCase(),y){var t=Object.values(y).filter((function(t){return t.username!==N&&(t.endpoints.extension.find((function(t){return t.id.toLowerCase().startsWith(e)}))||t.username.toLowerCase().includes(e)||t.name.toLowerCase().includes(e))}));_(t)}}function te(t){return void 0===t&&(t=""),e.__awaiter(this,void 0,void 0,(function(){var a,i;return e.__generator(this,(function(e){switch(e.label){case 0:j(!1),t=t.trim().toLowerCase(),/^[0-9*#+]+$/.test(t)?R(!0):R(!1),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,d.searchPhonebook(1,t,"")];case 2:return a=e.sent(),L(a.rows),[3,4];case 3:return i=e.sent(),console.error("Error fetching phonebook:",i),[3,4];case 4:return j(!0),[2]}}))}))}function ae(e){return e&&"object"==typeof e&&"endpoints"in e&&"username"in e}function ie(e){return e&&"object"==typeof e&&"source"in e&&"name"in e}t.useEffect((function(){return function(){Z.cancel()}}),[Z]),s.useEventListener("phone-island-call-transfer",(function(e){l.handleAttendedTransfer(e.number,X),c.eventDispatch("phone-island-call-transfer-opened",{})})),t.useEffect((function(){y&&N&&(ee(O),B&&(te(O),H(!1)))}),[y,N]),t.useEffect((function(){var e,t,a=function(){var e,t,a;G(!!(U.current&&U.current.scrollTop>3)),U.current&&(null===(e=U.current)||void 0===e?void 0:e.offsetHeight)+(null===(t=U.current)||void 0===t?void 0:t.scrollTop)>=(null===(a=U.current)||void 0===a?void 0:a.scrollHeight)-10&&Q((function(e){return e+10}))};return x?null===(e=U.current)||void 0===e||e.addEventListener("scroll",a):null===(t=U.current)||void 0===t||t.removeEventListener("scroll",a),function(){var e;return null===(e=U.current)||void 0===e?void 0:e.removeEventListener("scroll",a)}}),[x]);var re=o.useTranslation().t,ne=b.default.createElement("div",{className:"pi-relative pi-flex pi-flex-col"},b.default.createElement("div",{className:"pi-relative pi-z-50"},b.default.createElement("div",{className:"pi-flex pi-gap-4"},b.default.createElement(a.Button,{variant:"transparent",onClick:function(){l.isInsideConferenceList()&&c.eventDispatch("phone-island-conference-list-close",{}),r.backToPreviousView()},"data-tooltip-id":"contact-list-tooltip-back-to-call","data-tooltip-content":re("Tooltip.Back to call")||""},b.default.createElement(i.FontAwesomeIcon,{className:"pi-h-6 pi-w-6",icon:n.faArrowLeft})),b.default.createElement("input",{"data-stop-propagation":!0,type:"text",onChange:function(e){V(e.currentTarget.value),Z(e.currentTarget.value),ee(e.currentTarget.value)},value:O,placeholder:re("Common.Search contact or phone number")||"",autoFocus:!0,spellCheck:!1,className:"pi-w-full pi-rounded-full dark:pi-bg-gray-950 pi-bg-gray-50 pi-border-2 pi-border-emerald-500 dark:pi-border-emerald-200 active:pi-border-emerald-500 dark:active:pi-border-emerald-200 focus:pi-border-emerald-500 dark:focus:pi-border-emerald-200 pi-text-gray-900 dark:pi-text-gray-50 pi-font-light pi-text-sm pi-px-5 focus:pi-outline-0 focus:pi-ring-0 pi-placeholder-gray-400 dark:pi-placeholder-gray-500 pi-font-[inherit]"}))),!k&&b.default.createElement("div",{className:"pi-mt-6"},Array.from({length:5}).map((function(e,t){return b.default.createElement("div",{key:t,className:"pi-animate-pulse pi-flex pi-items-center pi-space-x-4 pi-px-3 pi-py-1"},b.default.createElement("div",{className:"pi-flex pi-items-center pi-justify-center"},b.default.createElement("div",{className:"pi-rounded-full pi-h-12 pi-w-12 pi-bg-gray-300 dark:pi-bg-gray-700"})),b.default.createElement("div",{className:"pi-flex pi-flex-col pi-gap-2 pi-w-full"},b.default.createElement("div",{className:"pi-h-3 pi-w-4/5 pi-rounded pi-bg-gray-300 dark:pi-bg-gray-700"}),b.default.createElement("div",{className:"pi-h-3 pi-w-1/2 pi-rounded pi-bg-gray-300 dark:pi-bg-gray-700"})),b.default.createElement("div",{className:"pi-flex pi-items-center pi-justify-center pi-pr-2"},b.default.createElement("div",{className:"pi-rounded-full pi-h-12 pi-w-12 pi-bg-gray-300 dark:pi-bg-gray-700"})))}))),b.default.createElement("div",{className:k?"":"pi-hidden"},b.default.createElement("div",{className:"pi-z-30 pi-h-6 pi-pointer-events-none pi-bg-transparent pi-mt-7 pi-pr-4"},$&&b.default.createElement("div",{className:"pi-h-6 pi-w-full pi-bg-gradient-to-b dark:pi-from-black pi-from-gray-100 pi-to-transparent pi-z-100"})),b.default.createElement("div",{style:{marginTop:"-22px"},className:"pi-flex pi-flex-col pi-gap-7"},b.default.createElement("div",{style:{height:"17rem"},ref:U,className:"pi-relative pi-w-full pi-flex pi-flex-col pi-gap-1 pi-overflow-y-auto pi-overflow-x-hidden pi-scrollbar-thin pi-scrollbar-thumb-gray-400 pi-scrollbar-thumb-rounded-full pi-scrollbar-thumb-opacity-50 dark:pi-scrollbar-track-gray-900 pi-scrollbar-track-gray-200 pi-scrollbar-track-rounded-full pi-scrollbar-track-opacity-25"},M&&b.default.createElement("div",{className:"pi-flex pi-items-center pi-w-full pi-justify-between pi-px-3 pi-py-1 pi-rounded-md hover:pi-bg-gray-200 hover:dark:pi-bg-gray-800"},b.default.createElement("div",{className:"pi-flex pi-items-center pi-gap-4"},b.default.createElement(f.default,{placeHolderIcon:n.faUser}),b.default.createElement("div",null,b.default.createElement("div",{className:"pi-h-fit pi-max-w-48 pi-truncate pi-text-sm pi-font-medium"},re("Common.Phone number entered")),b.default.createElement("div",{className:"pi-text-sm pi-max-w-48 pi-text-gray-700 dark:pi-text-gray-300"},O))),b.default.createElement("div",{className:"pi-flex pi-gap-3.5"},b.default.createElement(a.Button,{onClick:function(){return l.clickTransferOrConference(O,X)},variant:"green","data-tooltip-id":"contact-list-tooltip-call-to-transfer","data-tooltip-content":l.isInsideConferenceList()?re("Conference.Add participant"):re("Tooltip.Transfer call")},b.default.createElement(i.FontAwesomeIcon,{className:"pi-h-6 pi-w-6",icon:n.faPhone})))),Y&&Y.slice(0,K).map((function(e,t){return b.default.createElement("div",{key:t,className:"pi-flex pi-items-center pi-w-full pi-justify-between pi-px-3 pi-py-1 pi-rounded-md hover:pi-bg-gray-200 hover:dark:pi-bg-gray-800"},b.default.createElement("div",{className:"pi-flex pi-items-center pi-gap-4"},function(){var t,a;return ae(e)?b.default.createElement(b.default.Fragment,null,b.default.createElement(f.default,{username:null==e?void 0:e.username,status:null==e?void 0:e.mainPresence,placeHolderIcon:n.faHeadset}),b.default.createElement("div",null,b.default.createElement("div",{"data-stop-propagation":!0,className:"pi-h-fit pi-max-w-48 pi-truncate pi-text-sm pi-font-medium"},e.name),b.default.createElement("div",{className:"pi-text-sm pi-max-w-48 pi-text-gray-700 dark:pi-text-gray-300"},null===(a=null===(t=null==e?void 0:e.endpoints)||void 0===t?void 0:t.mainextension[0])||void 0===a?void 0:a.id))):ie(e)?b.default.createElement(b.default.Fragment,null,b.default.createElement(f.default,{placeHolderIcon:"person"===e.kind?n.faUser:n.faBuilding}),b.default.createElement("div",null,b.default.createElement("div",{"data-stop-propagation":!0,className:"pi-h-fit pi-max-w-48 pi-truncate pi-text-sm pi-font-medium"},e.displayName||"-"),b.default.createElement("div",{className:"pi-text-sm pi-max-w-48 pi-text-gray-700 dark:pi-text-gray-300"},b.default.createElement("span",null,d.getMainPhoneNumber(e)||"-"),d.getTotalPhoneNumbers(e)>1&&b.default.createElement("span",{className:"pi-ml-2"},re("Common.plus_x_others",{count:d.getTotalPhoneNumbers(e)-1}))))):void 0}()),b.default.createElement("div",{className:"pi-flex pi-gap-3.5"},ae(e)?b.default.createElement(a.Button,{onClick:function(){var t,a;return"online"===e.mainPresence&&l.clickTransferOrConference(null===(a=null===(t=null==e?void 0:e.endpoints)||void 0===t?void 0:t.mainextension[0])||void 0===a?void 0:a.id,X)},variant:"green",disabled:"online"!==e.mainPresence,"data-tooltip-id":"online"===e.mainPresence?"contact-list-tooltip-left":"","data-tooltip-content":l.isInsideConferenceList()?re("Conference.Add participant"):re("Tooltip.Transfer call")},b.default.createElement(i.FontAwesomeIcon,{className:"pi-h-6 pi-w-6",icon:n.faPhone})):ie(e)?d.getTotalPhoneNumbers(e)<2?b.default.createElement(a.Button,{onClick:function(){return l.clickTransferOrConference(d.getMainPhoneNumber(e),X)},variant:"green",disabled:0==d.getTotalPhoneNumbers(e),"data-tooltip-id":d.getTotalPhoneNumbers(e)>0?"contact-list-tooltip-left":"","data-tooltip-content":l.isInsideConferenceList()?re("Conference.Add participant"):re("Tooltip.Transfer call")},b.default.createElement(i.FontAwesomeIcon,{className:"pi-h-6 pi-w-6",icon:n.faPhone})):b.default.createElement(a.Button,{onClick:function(){return I(e),void X.island.setContactListView("selectContactNumber")},variant:"transparent","data-tooltip-id":"contact-list-tooltip-left","data-tooltip-content":re("Tooltip.Select phone number")},b.default.createElement(i.FontAwesomeIcon,{className:"pi-h-6 pi-w-6",icon:n.faAngleRight})):void 0))})),0===Y.length&&!M&&b.default.createElement("p",{className:" pi-font-medium pi-w-full pi-flex pi-justify-center pi-text-sm"},re("No contacts found"))))));return b.default.createElement(b.default.Fragment,null,function(){switch(E){case"main":default:return ne;case"selectContactNumber":return b.default.createElement(p.SelectContactNumberView,{contact:A})}}(),b.default.createElement(u.CustomThemedTooltip,{className:"pi-z-1000",id:"contact-list-tooltip-left",place:"left"}),b.default.createElement(u.CustomThemedTooltip,{className:"pi-z-1000",id:"contact-list-tooltip-back-to-call",place:"right"}),b.default.createElement(u.CustomThemedTooltip,{className:"pi-z-1000",id:"contact-list-tooltip-call-to-transfer",place:"left"}))};
//# sourceMappingURL=ContactListView.js.map
