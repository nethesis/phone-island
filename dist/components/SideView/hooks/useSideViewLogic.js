"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../../../node_modules/tslib/tslib.es6.js"),i=require("react");require("../../../node_modules/react-redux/es/index.js");var n=require("../../../store/index.js"),r=require("../../../utils/deviceUtils.js"),u=require("../../../lib/webrtc/janus.js"),o=require("../../../lib/phone/trunk.js"),t=require("../../../lib/devices/devices.js"),l=require("../../../utils/genericFunctions/eventDispatch.js"),s=require("../../../node_modules/react-redux/es/hooks/useDispatch.js"),a=require("../../../node_modules/react-redux/es/hooks/useSelector.js");exports.useSideViewLogic=function(c){var d,v,h,p,f,g,b,m,_=s.useDispatch(),S=a.useSelector((function(e){return e.currentUser})),j=a.useSelector((function(e){return e.users})),w=a.useSelector((function(e){return e.paramUrl})),k=n.store.select.mediaDevices.videoInputDevices(n.store.getState()),q=i.useRef(u.default),C=a.useSelector((function(e){return e.currentUser.conversations})),V=i.useState([]),D=V[0],U=V[1],y=i.useState(!0),T=y[0],x=y[1],O=i.useCallback((function(e){if(_.island.toggleSideViewVisible(!1),"openUrl"===e){var i=Object.values(C).find((function(e){return Object.keys(e).length>0})),n=i?Object.values(i)[0]:null;if((null==n?void 0:n.connected)&&"in"===(null==n?void 0:n.direction)){var r={counterpartNum:n.counterpartNum,counterpartName:n.counterpartName,owner:n.owner,uniqueId:n.uniqueId,throughQueue:n.throughQueue,throughTrunk:n.throughTrunk,direction:n.direction,connected:n.connected};l.eventDispatch("phone-island-url-parameter-opened",r)}}else null!==e&&_.island.setIslandView(e)}),[_.island,C]),Q=i.useCallback((function(){return e.__awaiter(void 0,void 0,void 0,(function(){var i;return e.__generator(this,(function(e){switch(e.label){case 0:return k.length>0?[4,t.checkWebCamPermission()]:[3,2];case 1:return i=e.sent(),x(i),[2,i];case 2:return x(!1),[2,!1]}}))}))}),[k.length]),I=i.useCallback((function(){return e.__awaiter(void 0,void 0,void 0,(function(){return e.__generator(this,(function(e){switch(e.label){case 0:return[4,Q()];case 1:return e.sent()&&(O("video"),n.store.dispatch.currentCall.updateCurrentCall({isLocalVideoEnabled:!0,isStartingVideoCall:!0})),[2]}}))}))}),[Q,O]),N=i.useCallback((function(){O("video"),n.store.dispatch.screenShare.update({isStartingScreenShare:!0})}),[O]),P=i.useMemo((function(){var e;return(null===(e=null==S?void 0:S.profile)||void 0===e?void 0:e.macro_permissions)||{}}),[null===(d=null==S?void 0:S.profile)||void 0===d?void 0:d.macro_permissions]),E=i.useMemo((function(){var e,i,n,r,u,o;return{canRecord:(null===(n=null===(i=null===(e=null==P?void 0:P.settings)||void 0===e?void 0:e.permissions)||void 0===i?void 0:i.recording)||void 0===n?void 0:n.value)||!1,canShareScreen:"safari"!==q.current.webRTCAdapter.browserDetails.browser&&((null===(o=null===(u=null===(r=null==P?void 0:P.nethvoice_cti)||void 0===r?void 0:r.permissions)||void 0===u?void 0:u.screen_sharing)||void 0===o?void 0:o.value)||!1),canSwitchDevice:(null==D?void 0:D.length)>0}}),[null===(p=null===(h=null===(v=null==P?void 0:P.settings)||void 0===v?void 0:v.permissions)||void 0===h?void 0:h.recording)||void 0===p?void 0:p.value,null===(b=null===(g=null===(f=null==P?void 0:P.nethvoice_cti)||void 0===f?void 0:f.permissions)||void 0===g?void 0:g.screen_sharing)||void 0===b?void 0:b.value,null==D?void 0:D.length,null===(m=null==S?void 0:S.default_device)||void 0===m?void 0:m.type,c]),M=i.useMemo((function(){var e=Object.values(C).find((function(e){return Object.keys(e).length>0})),i=e?Object.values(e)[0]:null;if("never"===w.openParamUrlType)return!1;if(!(null==i?void 0:i.connected)||"in"!==(null==i?void 0:i.direction))return!1;if("button"===w.openParamUrlType){if(w.onlyQueues&&(null==i?void 0:i.throughQueue))return!0;if(!w.onlyQueues&&(o.isFromTrunk(i.counterpartNum)||(null==i?void 0:i.throughQueue)))return!0}return!1}),[C,w.onlyQueues,w.openParamUrlType]);return i.useEffect((function(){if(S&&j){var e=r.getAvailableDevices(S,j);U(e)}}),[S,j]),e.__assign(e.__assign({userInformation:S,availableDevices:D,videoInputDevices:k,isVideoCallButtonVisible:T,isUrlButtonEnabled:M,hasValidUrl:w.hasValidUrl},E),{goToVideoCall:I,goToScreenSharing:N,closeSideViewAndLaunchEvent:O})};
//# sourceMappingURL=useSideViewLogic.js.map
