{"version":3,"file":"Progress.js","sources":["../../../src/components/AudioPlayerView/Progress.tsx"],"sourcesContent":["import React, { type FC, useState, useEffect, useRef, useCallback } from 'react'\nimport { useSelector } from 'react-redux'\nimport { Dispatch, RootState } from '../../store'\nimport { formatTime } from '../../utils/genericFunctions/player'\nimport { useDispatch } from 'react-redux'\nimport { StyledCustomRange } from '../../styles/CustomRange.styles'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faPlay, faPause, faTrash, faVolumeHigh, faVolumeXmark } from '@fortawesome/free-solid-svg-icons'\nimport { eventDispatch, useEventListener } from '../../utils'\n\nexport const Progress: FC<ProgressTypes> = ({ isPlayer }) => {\n  const { audioPlayer, audioPlayerPlaying, audioPlayerTrackDuration } = useSelector(\n    (state: RootState) => state.player,\n  )\n  const progressBarRef = useRef<any>()\n  const progressAnimationRef = useRef<any>()\n  const [timeProgress, setTimeProgress] = useState<string>('00:00')\n  const [displayDuration, setDisplayDuration] = useState<string>()\n  const dispatch = useDispatch<Dispatch>()\n  const [trackDuration, setTrackDuration] = useState<number>(\n    (audioPlayerTrackDuration && Math.round(audioPlayerTrackDuration)) || 0,\n  )\n  const { recorded, playing } = useSelector((state: RootState) => state.recorder)\n  const [isMuted, setIsMuted] = useState<boolean>(false)\n\n  const progressAnimation = useCallback(() => {\n    const currentTime = audioPlayer?.current?.currentTime\n    currentTime && setTimeProgress(formatTime(Math.round(currentTime)))\n    progressBarRef.current.value = currentTime\n    trackDuration &&\n      currentTime &&\n      progressBarRef.current.style.setProperty(\n        '--range-progress',\n        `${(currentTime / trackDuration) * 100}%`,\n      )\n    progressAnimationRef.current = requestAnimationFrame(progressAnimation)\n  }, [audioPlayer, trackDuration, progressBarRef])\n\n  useEffect(() => {\n    if (audioPlayerPlaying) {\n      progressAnimationRef.current = requestAnimationFrame(progressAnimation)\n    } else {\n      cancelAnimationFrame(progressAnimationRef.current)\n    }\n  }, [audioPlayerPlaying])\n\n  useEffect(() => {\n    if (audioPlayerTrackDuration) {\n      setTrackDuration(Math.round(audioPlayerTrackDuration))\n      setDisplayDuration(formatTime(audioPlayerTrackDuration))\n    }\n  }, [audioPlayerTrackDuration])\n\n  useEffect(() => {\n    return () => {\n      cancelAnimationFrame(progressAnimationRef.current)\n    }\n  }, [])\n\n  function handleProgressChange() {\n    dispatch.player.setAudioPlayerCurrentTime(progressBarRef.current.value)\n  }\n\n  function stopPropagation(e: React.MouseEvent<HTMLDivElement> | React.TouchEvent<HTMLDivElement>) {\n    e.stopPropagation()\n  }\n\n  function handlePause() {\n    dispatch.player.pauseAudioPlayer()\n    dispatch.recorder.setPlaying(false)\n    dispatch.recorder.setPaused(true)\n    eventDispatch('phone-island-recording-paused', {})\n  }\n  useEventListener('phone-island-recording-pause', (data: {}) => {\n    handlePause()\n  })\n\n  function handlePlay() {\n    dispatch.player.startAudioPlayer(() => {\n      // The callback for the end event of the audio player\n      dispatch.recorder.setPlaying(false)\n      dispatch.recorder.setPaused(true)\n    })\n    dispatch.recorder.setPlaying(true)\n    eventDispatch('phone-island-recording-played', {})\n  }\n  useEventListener('phone-island-recording-play', (data: {}) => {\n    handlePlay()\n  })\n\n  function handleDelete() {\n    dispatch.recorder.resetRecorded()\n    eventDispatch('phone-island-recording-deleted', {})\n  }\n  useEventListener('phone-island-recording-delete', (data: {}) => {\n    handleDelete()\n  })\n\n  function handleToggleMute() {\n    if (audioPlayer?.current) {\n      const newMuteState = !isMuted\n      audioPlayer.current.muted = newMuteState\n      setIsMuted(newMuteState)\n    }\n  }\n\n  return (\n    <div className='pi-w-full pi-h-full pi-flex pi-flex-col pi-items-center pi-justify-between pi-px-2'>\n      {/* Player controls with progress bar */}\n      <div className='pi-w-full pi-flex pi-items-center pi-justify-between pi-gap-2'>\n        {isPlayer ? (\n          <div className='pi-cursor-pointer pi-flex-none' onClick={handleToggleMute}>\n            <FontAwesomeIcon\n              icon={isMuted ? faVolumeXmark : faVolumeHigh}\n              className='pi-h-4 pi-w-4 pi-text-gray-700 dark:pi-text-gray-300'\n            />\n          </div>\n        ) : (\n          <>\n            {audioPlayerPlaying ? (\n              <div\n                onClick={handlePause}\n                className='pi-cursor-pointer pi-flex-none'\n                data-tooltip-id='tooltip-pause-recorder-view'\n                data-tooltip-content={'Pause'}\n              >\n                <FontAwesomeIcon\n                  icon={faPause}\n                  className='pi-h-4 pi-w-4 pi-text-gray-700 dark:pi-text-gray-300'\n                />\n              </div>\n            ) : (\n              <div\n                onClick={handlePlay}\n                className='pi-cursor-pointer pi-flex-none'\n                data-tooltip-id='tooltip-play-recorder-view'\n                data-tooltip-content={'Play'}\n              >\n                <FontAwesomeIcon\n                  icon={faPlay}\n                  className='pi-h-4 pi-w-4 pi-text-gray-700 dark:pi-text-gray-300'\n                />\n              </div>\n            )}\n          </>\n        )}\n\n        <div\n          className='pi-w-full pi-flex-grow pi-mx-2'\n          onClick={stopPropagation}\n          onMouseDown={stopPropagation}\n          onTouchStart={stopPropagation}\n        >\n          <StyledCustomRange\n            data-stop-propagation={true}\n            ref={progressBarRef}\n            defaultValue={0}\n            type='range'\n            step='1'\n            min='0'\n            max={(trackDuration && trackDuration) || 0}\n            onChange={handleProgressChange}\n            className='pi-text-green-600 dark:pi-text-green-500'\n          />\n        </div>\n\n        {!isPlayer && (\n          <div\n            onClick={handleDelete}\n            className='pi-cursor-pointer pi-flex-none'\n            data-tooltip-id='tooltip-delete-recorder-view'\n            data-tooltip-content={'Delete'}\n          >\n            <FontAwesomeIcon\n              icon={faTrash}\n              className='pi-h-4 pi-w-4 pi-text-gray-700 dark:pi-text-gray-200'\n            />\n          </div>\n        )}\n      </div>\n\n      {/* Time indicators */}\n      <div className='pi-flex pi-justify-between pi-w-full pi-text-xs pi-mt-2 pi-mb-1'>\n        <div className='pi-font-medium pi-text-gray-700 dark:pi-text-gray-200 pi-truncate pi-max-w-[45%]'>\n          {timeProgress}\n        </div>\n        <div className='pi-font-medium pi-text-gray-700 dark:pi-text-gray-200 pi-truncate pi-max-w-[45%]'>\n          {displayDuration}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default Progress\nexport interface ProgressTypes {\n  isPlayer?: boolean\n}\n"],"names":["Progress","_a","isPlayer","_b","useSelector","state","player","audioPlayer","audioPlayerPlaying","audioPlayerTrackDuration","progressBarRef","useRef","progressAnimationRef","_c","useState","timeProgress","setTimeProgress","_d","displayDuration","setDisplayDuration","dispatch","useDispatch","_e","Math","round","trackDuration","setTrackDuration","_f","recorder","_g","isMuted","setIsMuted","progressAnimation","useCallback","currentTime","current","formatTime","value","style","setProperty","requestAnimationFrame","stopPropagation","e","handlePause","pauseAudioPlayer","setPlaying","setPaused","eventDispatch","handlePlay","startAudioPlayer","handleDelete","resetRecorded","useEffect","cancelAnimationFrame","useEventListener","data","React","createElement","className","onClick","newMuteState","muted","FontAwesomeIcon","icon","faVolumeXmark","faVolumeHigh","Fragment","faPause","faPlay","onMouseDown","onTouchStart","StyledCustomRange","ref","defaultValue","type","step","min","max","onChange","setAudioPlayerCurrentTime","faTrash"],"mappings":"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"}