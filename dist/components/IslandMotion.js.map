{"version":3,"file":"IslandMotion.js","sources":["../../src/components/IslandMotion.tsx"],"sourcesContent":["// Copyright (C) 2025 Nethesis S.r.l.\n// SPDX-License-Identifier: AGPL-3.0-or-later\n\nimport React, { type ReactNode, FC, useMemo, useEffect } from 'react'\nimport { RootState } from '../store'\nimport { useSelector } from 'react-redux'\nimport { motion } from 'framer-motion'\nimport { eventDispatch } from '../utils'\n\nexport const IslandMotion: FC<IslandMotionProps> = ({ children }) => {\n  // Retrieve needed stored variables\n  const {\n    incoming,\n    outgoing,\n    accepted,\n    transferring,\n    incomingWebRTC,\n    incomingSocket,\n    conferencing,\n  } = useSelector((state: RootState) => state.currentCall)\n  const { isListen } = useSelector((state: RootState) => state.listen)\n  const { view, isOpen, actionsExpanded, sideViewIsVisible, isFromStreaming, isExtraLarge } = useSelector(\n    (state: RootState) => state.island,\n  )\n  const { activeAlertsCount } = useSelector((state: RootState) => state.alerts.status)\n  const {\n    variants,\n    border_radius_collapsed,\n    border_radius_expanded,\n    border_radius_collapsed_conference,\n    padding_x_collapsed,\n    padding_y_collapsed,\n    padding_expanded,\n    alert_padding_expanded,\n  } = useSelector((state: RootState) => state.motions)\n  const { isActive } = useSelector((state: RootState) => state.conference)\n\n  const motionVariants = useMemo(() => {\n    // Initial size\n    let size: SizeTypes = {\n      width: 0,\n      height: 0,\n      padding: padding_expanded,\n    }\n\n    switch (view) {\n      case 'call':\n        if (isOpen) {\n          if (accepted && transferring && conferencing) {\n            if (actionsExpanded) {\n              size = {\n                width: variants.call.expanded.transfer.actionsExpanded.width,\n                height: variants.call.expanded.transfer.actionsExpanded.height,\n              }\n            } else {\n              size = {\n                width: variants.call.expanded.transfer.width,\n                height: variants.call.expanded.transfer.height,\n              }\n            }\n          } else if (accepted && actionsExpanded) {\n            size = {\n              width: variants.call.expanded.accepted.actionsExpanded.width,\n              height: variants.call.expanded.accepted.actionsExpanded.height,\n            }\n          } else if (accepted && !isListen) {\n            size = {\n              width: variants.call.expanded.accepted.width,\n              height: variants.call.expanded.accepted.height,\n            }\n          } else if (accepted && isListen) {\n            size = {\n              width: variants.call.expanded.listening.width,\n              height: variants.call.expanded.listening.height,\n            }\n          } else if (incoming && !isFromStreaming) {\n            size = {\n              width: variants.call.expanded.incoming.width,\n              height: variants.call.expanded.incoming.height,\n            }\n          } else if (incoming && isFromStreaming) {\n            size = {\n              width: variants.call.expanded.incomingStreaming.width,\n              height: variants.call.expanded.incomingStreaming.height,\n            }\n          } else if (outgoing && !isFromStreaming) {\n            size = {\n              width: variants.call.expanded.outgoing.width,\n              height: variants.call.expanded.outgoing.height,\n            }\n          } else if (outgoing && isFromStreaming) {\n            size = {\n              width: variants.call.expanded.outgoingStreaming.width,\n              height: variants.call.expanded.outgoingStreaming.height,\n            }\n          }\n        } else {\n          size = {\n            width: variants.call.collapsed.width,\n            height: variants.call.collapsed.height,\n          }\n        }\n        break\n\n      case 'keypad':\n        size = isOpen\n          ? {\n            width: variants.keypad.expanded.width,\n            height: variants.keypad.expanded.height,\n          }\n          : {\n            width: variants.transfer.collapsed.width,\n            height: variants.transfer.collapsed.height,\n          }\n        break\n\n      case 'video':\n        if (isOpen) {\n          size = {\n            width: variants.video.expanded.width,\n            height: variants.video.expanded.height,\n            padding: variants.video.expanded.padding,\n          }\n        } else {\n          size = {\n            width: variants.video.collapsed.width,\n            height: variants.video.collapsed.height,\n          }\n        }\n        break\n      case 'transfer':\n      case 'player':\n      case 'recorder':\n      case 'physicalPhoneRecorder':\n      case 'settings':\n      case 'conference':\n        size = isOpen\n          ? {\n            width: variants[view].expanded.width,\n            height: variants[view].expanded.height,\n          }\n          : {\n            width: variants[view].collapsed.width,\n            height: variants[view].collapsed.height,\n          }\n        break\n\n      case 'switchDevice':\n        size = isOpen\n          ? {\n            width: variants.switchDevice.expanded.width,\n            height: variants.switchDevice.expanded.height,\n          }\n          : {\n            width: variants.video.collapsed.width,\n            height: variants.video.collapsed.height,\n          }\n        break\n\n      case 'waitingConference':\n        size = isOpen\n          ? {\n            width: variants.waitingConference.expanded.width,\n            height: variants.waitingConference.expanded.height,\n          }\n          : {\n            width: variants.waitingConference.collapsed.width,\n            height: variants.waitingConference.collapsed.height,\n          }\n        break\n      case 'streamingAnswer':\n        size = isOpen\n          ? isExtraLarge\n            ? {\n              width: variants.streamingAnswer.extraLarge.width,\n              height: variants.streamingAnswer.extraLarge.height,\n              padding: variants.streamingAnswer.extraLarge.padding,\n            }\n            : {\n              width: variants.streamingAnswer.expanded.width,\n              height: variants.streamingAnswer.expanded.height,\n              padding: variants.streamingAnswer.expanded.padding,\n            }\n          : {\n            width: variants.streamingAnswer.collapsed.width,\n            height: variants.streamingAnswer.collapsed.height,\n          }\n        break\n    }\n\n    const isAlert: boolean = activeAlertsCount > 0\n\n    return {\n      width: `${size.width === 0 && isAlert ? variants.alerts.width : size.width}px`,\n      height: `${\n        // If there is an alert and the island is open put the correct height\n        isAlert && isOpen\n          ? variants.alerts.height +\n          (size.height === 0 ? alert_padding_expanded * 2 : alert_padding_expanded)\n          : size.height\n        }px`,\n      borderRadius: isOpen\n        ? `${border_radius_expanded}px`\n        : isActive && view === 'waitingConference'\n          ? `${border_radius_collapsed_conference}px`\n          : `${border_radius_collapsed}px`,\n      padding: isOpen\n        ? size.padding != undefined\n          ? `${size.padding}px`\n          : `${padding_expanded}px`\n        : `${padding_x_collapsed}px ${padding_y_collapsed}px`,\n    }\n  }, [\n    view,\n    isOpen,\n    accepted,\n    transferring,\n    actionsExpanded,\n    isListen,\n    incoming,\n    outgoing,\n    activeAlertsCount,\n    variants,\n    border_radius_collapsed,\n    border_radius_expanded,\n    padding_x_collapsed,\n    padding_y_collapsed,\n    padding_expanded,\n    alert_padding_expanded,\n    incomingWebRTC,\n    incomingSocket,\n    isActive,\n    isFromStreaming,\n    isExtraLarge\n  ])\n\n  useEffect(() => {\n    let sizeInformation: any = {}\n    sizeInformation.width = motionVariants?.width\n    sizeInformation.height = motionVariants?.height\n    eventDispatch('phone-island-size-change', {\n      sizeInformation,\n    })\n  }, [\n    motionVariants,\n    view,\n    isOpen,\n    accepted,\n    transferring,\n    actionsExpanded,\n    isListen,\n    incoming,\n    outgoing,\n    activeAlertsCount,\n    variants,\n    border_radius_collapsed,\n    border_radius_expanded,\n    padding_x_collapsed,\n    padding_y_collapsed,\n    padding_expanded,\n    alert_padding_expanded,\n    sideViewIsVisible,\n    incomingSocket,\n    incomingWebRTC,\n    isActive,\n    isExtraLarge,\n  ])\n\n  return (\n    <motion.div\n      className={`${isOpen ? 'pi-cursor-grab' : 'pi-cursor-pointer'\n        } pi-pointer-events-auto pi-overflow-hidden dark:pi-bg-gray-950 pi-bg-gray-50 pi-text-xs dark:pi-text-white pi-text-gray-900 hover:pi-shadow-2xl pi-rounded-3xl pi-transition-shadow`}\n      animate={motionVariants}\n      transition={{\n        duration: 0.15,\n        ease: 'easeOut',\n      }}\n    >\n      {children}\n    </motion.div>\n  )\n}\n\ninterface IslandMotionProps {\n  children: ReactNode\n}\n\ntype SizeTypes = {\n  width: number\n  height: number\n  padding?: number\n}\n\nexport default IslandMotion\n"],"names":["IslandMotion","_a","children","_b","useSelector","state","currentCall","incoming","outgoing","accepted","transferring","incomingWebRTC","incomingSocket","conferencing","isListen","listen","_c","island","view","isOpen","actionsExpanded","sideViewIsVisible","isFromStreaming","isExtraLarge","activeAlertsCount","alerts","status","_d","motions","variants","border_radius_collapsed","border_radius_expanded","border_radius_collapsed_conference","padding_x_collapsed","padding_y_collapsed","padding_expanded","alert_padding_expanded","isActive","conference","motionVariants","useMemo","size","width","height","padding","call","expanded","transfer","listening","incomingStreaming","outgoingStreaming","collapsed","keypad","video","switchDevice","waitingConference","streamingAnswer","extraLarge","isAlert","concat","borderRadius","undefined","useEffect","sizeInformation","eventDispatch","React","createElement","motion","div","className","animate","transition","duration","ease"],"mappings":"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"}