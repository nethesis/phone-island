{"version":3,"file":"index.js","sources":["../../../src/components/StreamingImage/index.tsx"],"sourcesContent":["// Copyright (C) 2024 Nethesis S.r.l.\n// SPDX-License-Identifier: AGPL-3.0-or-later\n\nimport React, { FC, memo, useEffect, useState } from 'react'\nimport { useSelector } from 'react-redux'\nimport { RootState } from '../../store'\nimport { getStreamingSourceId } from '../../utils/streaming/getStreamingSourceId'\nimport VideoStreamingSkeleton from '../VideoStreamingSkeleton'\n\n/**\n * Component that displays the streaming image from a source\n */\nconst StreamingImage: FC = () => {\n  const streamingSourceNumber = useSelector(\n    (state: RootState) => state.currentCall.streamingSourceNumber,\n  )\n  const isFromStreaming = useSelector((state: RootState) => state.island.isFromStreaming)\n  const sourceImages = useSelector((state: RootState) => state.streaming.sourceImages)\n  const videoSources = useSelector((state: RootState) => state.streaming.videoSources)\n\n  const [refreshKey, setRefreshKey] = useState(0)\n  const [imageLoaded, setImageLoaded] = useState(false)\n\n  const sourceId = streamingSourceNumber ? getStreamingSourceId(streamingSourceNumber) : undefined\n\n  // Find the source to get the image\n  const source =\n    streamingSourceNumber && videoSources\n      ? Object.values(videoSources).find((source) => source.extension === streamingSourceNumber)\n      : null\n\n  // get image URL from the source ID or from the source object\n  const imageUrl = sourceId ? (sourceImages[sourceId] || source?.image) : null\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setRefreshKey((prev) => prev + 1)\n    }, 500)\n\n    return () => clearInterval(interval)\n  }, [])\n\n  useEffect(() => {\n    if (imageUrl) {\n      setImageLoaded(false)\n    }\n  }, [imageUrl])\n\n  if (!isFromStreaming || !streamingSourceNumber) {\n    return null\n  }\n\n  if (!imageUrl) {\n    return <VideoStreamingSkeleton className='pi-w-[28.2rem] pi-h-[10.5rem] pi-mt-4' />\n  }\n\n  return (\n    <div className='pi-mt-4 pi-w-[28.2rem] pi-flex pi-justify-center'>\n      <div className='pi-relative pi-h-[10.5rem] pi-w-[110rem] pi-overflow-hidden pi-rounded-lg pi-border pi-border-gray-300 dark:pi-border-gray-700'>\n        {!imageLoaded && (\n          <VideoStreamingSkeleton className='pi-absolute pi-inset-0 pi-w-full pi-h-full' />\n        )}\n        <img\n          key={refreshKey}\n          src={imageUrl}\n          alt='Streaming view'\n          className={`pi-w-full pi-h-full pi-object-cover pi-transition-opacity pi-duration-300 ${imageLoaded ? 'pi-opacity-100' : 'pi-opacity-0'\n            }`}\n          onLoad={() => setImageLoaded(true)}\n          onError={() => setImageLoaded(false)}\n        />\n      </div>\n    </div>\n  )\n}\n\nexport default memo(StreamingImage)\n"],"names":["memo","streamingSourceNumber","useSelector","state","currentCall","isFromStreaming","island","sourceImages","streaming","videoSources","_a","useState","refreshKey","setRefreshKey","_b","imageLoaded","setImageLoaded","sourceId","getStreamingSourceId","undefined","source","Object","values","find","extension","imageUrl","image","useEffect","interval","setInterval","prev","clearInterval","React","createElement","className","VideoStreamingSkeleton","key","src","alt","concat","onLoad","onError"],"mappings":"uZA4EeA,EAAAA,EAAAA,MAhEY,WACzB,IAAMC,EAAwBC,eAC5B,SAACC,GAAqB,OAAAA,EAAMC,YAAYH,qBAAlB,IAElBI,EAAkBH,eAAY,SAACC,GAAqB,OAAAA,EAAMG,OAAOD,eAAb,IACpDE,EAAeL,eAAY,SAACC,GAAqB,OAAAA,EAAMK,UAAUD,YAAhB,IACjDE,EAAeP,eAAY,SAACC,GAAqB,OAAAA,EAAMK,UAAUC,YAAhB,IAEjDC,EAA8BC,EAAAA,SAAS,GAAtCC,EAAUF,EAAA,GAAEG,EAAaH,EAAA,GAC1BI,EAAgCH,EAAAA,UAAS,GAAxCI,EAAWD,EAAA,GAAEE,EAAcF,EAAA,GAE5BG,EAAWhB,EAAwBiB,EAAoBA,qBAACjB,QAAyBkB,EAGjFC,EACJnB,GAAyBQ,EACrBY,OAAOC,OAAOb,GAAcc,MAAK,SAACH,GAAW,OAAAA,EAAOI,YAAcvB,CAArB,IAC7C,KAGAwB,EAAWR,EAAYV,EAAaU,KAAaG,aAAA,EAAAA,EAAQM,OAAS,KAgBxE,OAdAC,EAAAA,WAAU,WACR,IAAMC,EAAWC,aAAY,WAC3BhB,GAAc,SAACiB,GAAS,OAAAA,EAAO,CAAC,GACjC,GAAE,KAEH,OAAO,WAAM,OAAAC,cAAcH,EAAS,CACrC,GAAE,IAEHD,EAAAA,WAAU,WACJF,GACFT,GAAe,EAEnB,GAAG,CAACS,IAECpB,GAAoBJ,EAIpBwB,EAKHO,EAAA,QAAAC,cAAA,MAAA,CAAKC,UAAU,oDACbF,EAAAA,QAAKC,cAAA,MAAA,CAAAC,UAAU,mIACXnB,GACAiB,EAAAA,QAACC,cAAAE,EAAsB,SAACD,UAAU,+CAEpCF,EAAAA,QACEC,cAAA,MAAA,CAAAG,IAAKxB,EACLyB,IAAKZ,EACLa,IAAI,iBACJJ,UAAW,6EAA6EK,OAAAxB,EAAc,iBAAmB,gBAEzHyB,OAAQ,WAAM,OAAAxB,GAAe,EAAK,EAClCyB,QAAS,WAAM,OAAAzB,GAAe,EAAM,MAhBnCgB,EAAAA,sBAACG,EAAAA,QAAsB,CAACD,UAAU,0CAJlC,IAyBX"}