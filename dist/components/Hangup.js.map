{"version":3,"file":"Hangup.js","sources":["../../src/components/Hangup.tsx"],"sourcesContent":["// Copyright (C) 2025 Nethesis S.r.l.\n// SPDX-License-Identifier: AGPL-3.0-or-later\n\nimport React, { type FC } from 'react'\nimport { motion } from 'framer-motion'\nimport { Button } from './Button'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faDownLeftAndUpRightToCenter, faGear, faPhone, faUpRightAndDownLeftFromCenter } from '@fortawesome/free-solid-svg-icons'\nimport { endConference, hangupCurrentCall, hangupCurrentPhysicalRecording } from '../lib/phone/call'\nimport { useDispatch, useSelector } from 'react-redux'\nimport { RootState } from '../store'\nimport { Dispatch } from '../store'\nimport { hangupAllExtensions } from '../lib/phone/call'\nimport { useTranslation } from 'react-i18next'\nimport { eventDispatch } from '../utils'\nimport { CustomThemedTooltip } from './CustomThemedTooltip'\n\n/**\n * Return the status of the\n */\nconst Hangup: FC<HangupProps> = ({\n  clickCallback,\n  isDestination,\n  description,\n  isPhysicalRecording,\n  buttonsVariant = 'transparent',\n  showFullscreenButton = false,\n  isExtraLarge = false,\n  onToggleExtraLarge,\n}) => {\n  const { transferring, incoming, accepted } = useSelector((state: RootState) => state.currentCall)\n  const dispatch = useDispatch<Dispatch>()\n  const { isOpen, sideViewIsVisible, view } = useSelector((state: RootState) => state.island)\n  const { isActive, conferenceStartedFrom } = useSelector((state: RootState) => state.conference)\n  const { username } = useSelector((state: RootState) => state.currentUser)\n\n  function handleHangup() {\n    if (incoming) {\n      hangupAllExtensions()\n    } else {\n      hangupCurrentCall()\n    }\n\n    // Delay the dispatch actions\n    setTimeout(() => {\n      dispatch.listen.setUpdateIntrudeStatus(false, '')\n      dispatch.listen.setUpdateListenStatus(false, '')\n    }, 2000)\n\n    // Show confirmation message when a call is transferred\n    if (transferring) {\n      setTimeout(() => {\n        dispatch.alerts.setAlert('call_transfered')\n        eventDispatch('phone-island-call-transfer-successfully-popup-open', {})\n        setTimeout(() => {\n          dispatch.alerts.removeAlert('call_transfered')\n          eventDispatch('phone-island-call-transfer-successfully-popup-close', {})\n        }, 2000)\n      }, 300)\n    }\n  }\n\n  const { t } = useTranslation()\n\n  // Helper function to determine tooltip content\n  const getToggleTooltipContent = () => {\n    if (view === 'streamingAnswer') {\n      return isExtraLarge ? t('Tooltip.Decrease') : t('Tooltip.Increase')\n    }\n    return t('Tooltip.Toggle fullscreen')\n  }\n\n  // Close side view and open settings view\n  const closeSideViewOpenSettings = () => {\n    if (sideViewIsVisible) {\n      eventDispatch('phone-island-sideview-close', {})\n    }\n    dispatch.island.setIslandView('settings')\n  }\n\n  // Phone island footer section\n  return (\n    <>\n      <div\n        className={` ${transferring\n          ? 'pi-grid pi-w-full pi-space-x-2 pi-justify-start'\n          : 'pi-flex pi-justify-center'\n          }`}\n      >\n        {/* The button to hangup the currentCall */}\n        <motion.div\n          className={`${transferring && description\n            ? 'pi-grid pi-grid-cols-4 pi-ml-4 pi-justify-start'\n            : 'pi-flex pi-w-12'\n            } `}\n        >\n          {/* collapse phone island button */}\n          {((isOpen && accepted) || (view === 'waitingConference' && isOpen)) && !showFullscreenButton && (\n            <div className='pi-grid pi-grid-cols-1'>\n              <Button\n                variant={buttonsVariant}\n                onClick={() => dispatch.island.handleToggleIsOpen()}\n                data-tooltip-id='tooltip-open-close-phone-island'\n                data-tooltip-content={\n                  isOpen ? t('Tooltip.Collapse') || '' : t('Tooltip.Open') || ''\n                }\n                className={`${transferring && description ? '' : 'pi--ml-28'}`}\n              >\n                <FontAwesomeIcon icon={faDownLeftAndUpRightToCenter} className='pi-w-6 pi-h-6' />\n              </Button>\n            </div>\n          )}\n\n          {/* expand/compress button for streaming */}\n          {((isOpen && accepted) || (view === 'waitingConference' && isOpen)) && showFullscreenButton && (\n            <div className='pi-grid pi-grid-cols-1'>\n              <Button\n                variant={buttonsVariant}\n                onClick={onToggleExtraLarge}\n                data-tooltip-id='tooltip-toggle-fullscreen-hangup'\n                data-tooltip-content={getToggleTooltipContent()}\n                className={`${transferring && description ? '' : 'pi--ml-28'}`}\n              >\n                <FontAwesomeIcon\n                  className='pi-h-6 pi-w-6'\n                  icon={isExtraLarge ? faDownLeftAndUpRightToCenter : faUpRightAndDownLeftFromCenter}\n                />\n              </Button>\n            </div>\n          )}\n\n          <Button\n            onClick={() => {\n              if (isPhysicalRecording) {\n                eventDispatch('phone-island-sideview-close', {})\n                hangupCurrentPhysicalRecording()\n              } else if (isActive) {\n                if (conferenceStartedFrom === username && view === 'waitingConference') {\n                  eventDispatch('phone-island-sideview-close', {})\n                  endConference()\n                } else {\n                  eventDispatch('phone-island-sideview-close', {})\n                  handleHangup()\n                }\n              } else {\n                eventDispatch('phone-island-sideview-close', {})\n                handleHangup()\n              }\n            }}\n            variant='red'\n            className={`${transferring && description\n              ? 'pi-gap-4 pi-font-medium pi-text-base pi-transition pi-min-w-12 pi-w-full pi-col-span-2'\n              : 'pi-gap-4 pi-font-medium pi-text-base pi-transition pi-min-w-12 pi-w-full'\n              }`}\n            data-tooltip-id={\n              (description && transferring) || (view === 'waitingConference' && isActive)\n                ? 'tooltip-top-transfer'\n                : 'tooltip-left-transfer'\n            }\n            data-tooltip-content={\n              description && transferring\n                ? description\n                : view === 'waitingConference' && isActive\n                  ? t('Conference.End conference')\n                  : `${t('Tooltip.Hangup')}`\n            }\n          >\n            <FontAwesomeIcon className='pi-rotate-135 pi-h-6 pi-w-6' icon={faPhone} />\n            {transferring && description && (\n              <motion.div\n                style={{ height: '17px' }}\n                className='pi-whitespace-nowrap pi-overflow-hidden'\n              >\n                {description}\n              </motion.div>\n            )}\n          </Button>\n          {((isOpen && accepted) || (view === 'waitingConference' && isOpen)) && (\n            <Button\n              variant={buttonsVariant}\n              onClick={() => closeSideViewOpenSettings()}\n              data-tooltip-id='tooltip-settings-view'\n              data-tooltip-content={t('Tooltip.Go to settings') || ''}\n              className={`${transferring && description ? 'pi-ml-5' : 'pi-justify-end pi-ml-16'\n                } pi-flex pi-items-center`}\n            >\n              <FontAwesomeIcon icon={faGear} className={`pi-h-6 pi-w-6`} />\n            </Button>\n          )}\n        </motion.div>\n      </div>\n      <CustomThemedTooltip className='pi-z-20' id='tooltip-left-transfer' place='left' />\n      <CustomThemedTooltip className='pi-z-20' id='tooltip-top-transfer' place='top' />\n      <CustomThemedTooltip className='pi-z-20' id='tooltip-open-close-phone-island' place='right' />\n      <CustomThemedTooltip className='pi-z-20' id='tooltip-settings-view' place='left' />\n      <CustomThemedTooltip className='pi-z-20' id='tooltip-toggle-fullscreen-hangup' place='top' />\n    </>\n  )\n}\n\nexport default Hangup\n\ninterface HangupProps {\n  clickCallback?: () => void\n  isDestination?: boolean\n  description?: any\n  isPhysicalRecording?: boolean\n  buttonsVariant?:\n  | 'transparent'\n  | 'default'\n  | 'red'\n  | 'green'\n  | 'neutral'\n  | 'transparentSideView'\n  | 'transparentSettings'\n  showFullscreenButton?: boolean\n  isFullscreen?: boolean\n  onToggleFullscreen?: () => void\n  isExtraLarge?: boolean\n  onToggleExtraLarge?: () => void\n}\n"],"names":["_a","clickCallback","isDestination","description","isPhysicalRecording","_b","buttonsVariant","_c","showFullscreenButton","_d","isExtraLarge","onToggleExtraLarge","_e","useSelector","state","currentCall","transferring","incoming","accepted","dispatch","useDispatch","_f","island","isOpen","sideViewIsVisible","view","_g","conference","isActive","conferenceStartedFrom","username","currentUser","handleHangup","hangupAllExtensions","hangupCurrentCall","setTimeout","listen","setUpdateIntrudeStatus","setUpdateListenStatus","alerts","setAlert","eventDispatch","removeAlert","t","useTranslation","React","createElement","Fragment","className","concat","motion","div","Button","variant","onClick","handleToggleIsOpen","FontAwesomeIcon","icon","faDownLeftAndUpRightToCenter","faUpRightAndDownLeftFromCenter","hangupCurrentPhysicalRecording","endConference","faPhone","style","height","setIslandView","faGear","CustomThemedTooltip","id","place"],"mappings":"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"}