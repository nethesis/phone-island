{"version":3,"file":"audio.js","sources":["../../../src/lib/phone/audio.ts"],"sourcesContent":["// Copyright (C) 2024 Nethesis S.r.l.\n// SPDX-License-Identifier: AGPL-3.0-or-later\n\nimport { store } from '../../store'\n\n/**\n * Manages the audio update action\n */\nexport async function updateAudioPlayerSource(payload: string) {\n  return new Promise((resolve, reject) => {\n    function canPlayCb() {\n      store.getState().player.audioPlayer?.current?.removeEventListener('canplaythrough', canPlayCb)\n      resolve(true)\n    }\n    function loadedMetadata() {\n      const trackDuration = store.getState().player.audioPlayer?.current?.duration\n      trackDuration && store.dispatch.player.updateAudioPlayerTrackDuration(trackDuration)\n      store\n        .getState()\n        .player.audioPlayer?.current?.removeEventListener('loadedmetadata', loadedMetadata)\n    }\n    try {\n      // Event handlers must be set before updating the audio source of the element\n      // Add event listener for canplaythrough event\n      store.getState().player.audioPlayer?.current?.addEventListener('canplaythrough', canPlayCb)\n      // Add event listener for onloadedmetadata event\n      store\n        .getState()\n        .player.audioPlayer?.current?.addEventListener('loadedmetadata', loadedMetadata)\n      // Update the audio player source\n      store.dispatch.player.updateAudioPlayerSrc(payload)\n    } catch (err) {\n      console.error(err)\n      reject(err)\n    }\n  })\n}\n"],"names":["payload","Promise","resolve","reject","_b","store","getState","player","audioPlayer","_a","current","addEventListener","canPlayCb","removeEventListener","_d","_c","loadedMetadata","trackDuration","duration","dispatch","updateAudioPlayerTrackDuration","updateAudioPlayerSrc","err","console","error"],"mappings":"6LAQM,SAAwCA,4FAC5C,MAAA,CAAA,EAAO,IAAIC,SAAQ,SAACC,EAASC,eAY3B,YAGEC,EAAqC,UAArCC,EAAAA,MAAMC,WAAWC,OAAOC,mBAAa,IAAAC,OAAA,EAAAA,EAAAC,wBAASC,iBAAiB,kBAdjE,SAASC,oBACPR,EAAqC,UAArCC,EAAAA,MAAMC,WAAWC,OAAOC,mBAAa,IAAAC,OAAA,EAAAA,EAAAC,wBAASG,oBAAoB,iBAAkBD,GACpFV,GAAQ,EACT,IAe+B,QAF9BY,EAEqB,UAFrBT,EAAKA,MACFC,WACAC,OAAOC,mBAAW,IAAAO,OAAA,EAAAA,EAAEL,eAAO,IAAAI,GAAAA,EAAEH,iBAAiB,kBAdnD,SAASK,gBACDC,EAA4D,QAA5Cb,EAAmC,QAAnCK,EAAAJ,EAAAA,MAAMC,WAAWC,OAAOC,mBAAW,IAAAC,OAAA,EAAAA,EAAEC,eAAO,IAAAN,OAAA,EAAAA,EAAEc,SACpED,GAAiBZ,EAAKA,MAACc,SAASZ,OAAOa,+BAA+BH,GAGxC,QAF9BH,EAEqB,UAFrBT,EAAKA,MACFC,WACAC,OAAOC,mBAAW,IAAAO,OAAA,EAAAA,EAAEL,eAAO,IAAAI,GAAAA,EAAED,oBAAoB,iBAAkBG,EACvE,IAUCX,EAAAA,MAAMc,SAASZ,OAAOc,qBAAqBrB,EAC5C,CAAC,MAAOsB,GACPC,QAAQC,MAAMF,GACdnB,EAAOmB,EACR,CACF,UACF"}