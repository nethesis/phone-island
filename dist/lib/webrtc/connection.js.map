{"version":3,"file":"connection.js","sources":["../../../src/lib/webrtc/connection.ts"],"sourcesContent":["// Copyright (C) 2024 Nethesis S.r.l.\n// SPDX-License-Identifier: AGPL-3.0-or-later\n\nimport { isWebrtcTotallyFree } from './extension'\nimport { store } from '../../store'\n\n/**\n * Checks the activity of webrtc and calls an action when is time to update it\n *\n * @param cb The callback to call when the extensions is free\n */\nexport function webrtcCheck(cb: () => void) {\n  // Retrieve the current timestamp\n  var now = new Date().getTime()\n  // Get lastActivity from the webrtc store\n  const { lastActivity, INACTIVE_DEADLINE_TIME } = store.getState().webrtc\n  // Retrieve the time from the last webrtc activity\n  const timeFromLastActivity = lastActivity ? now - lastActivity : now\n  if (timeFromLastActivity > INACTIVE_DEADLINE_TIME && isWebrtcTotallyFree()) {\n    console.debug(\n      'janus inactive for ' +\n        Math.round(timeFromLastActivity / 1000) +\n        ' sec (> deadline: ' +\n        INACTIVE_DEADLINE_TIME / 1000 +\n        '): force reactivation',\n    )\n    // Call the callback action\n    cb()\n  } else if (timeFromLastActivity > INACTIVE_DEADLINE_TIME && !isWebrtcTotallyFree()) {\n    console.debug('janus is in conversation: no reactivation')\n  } else {\n    console.debug(\n      'janus last activity detected ' +\n        Math.round(timeFromLastActivity / 1000) +\n        ' sec ago (< deadline: ' +\n        INACTIVE_DEADLINE_TIME / 1000 +\n        '): no reactivation',\n    )\n  }\n}\n"],"names":["cb","now","Date","getTime","_a","store","getState","webrtc","lastActivity","INACTIVE_DEADLINE_TIME","timeFromLastActivity","isWebrtcTotallyFree","console","debug","Math","round"],"mappings":"0JAWM,SAAsBA,GAE1B,IAAIC,GAAM,IAAIC,MAAOC,UAEfC,EAA2CC,EAAAA,MAAMC,WAAWC,OAA1DC,EAAYJ,EAAAI,aAAEC,2BAEhBC,EAAuBF,EAAeP,EAAMO,EAAeP,EAC7DS,EAAuBD,GAA0BE,EAAAA,uBACnDC,QAAQC,MACN,sBACEC,KAAKC,MAAML,EAAuB,KAClC,qBACAD,EAAyB,IACzB,yBAGJT,KACSU,EAAuBD,IAA2BE,EAAAA,sBAC3DC,QAAQC,MAAM,6CAEdD,QAAQC,MACN,gCACEC,KAAKC,MAAML,EAAuB,KAClC,yBACAD,EAAyB,IACzB,qBAGR"}