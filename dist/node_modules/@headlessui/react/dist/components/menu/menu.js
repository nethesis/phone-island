"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),require("../../../../../@react-aria/focus/dist/FocusScope.mjs.js");var e=require("../../../../../@react-aria/focus/dist/useFocusRing.mjs.js"),t=require("react");require("../../../../../@react-aria/interactions/dist/context.mjs.js"),require("../../../../../@react-aria/interactions/dist/useFocusVisible.mjs.js");var r=require("../../../../../@react-aria/interactions/dist/useHover.mjs.js"),s=require("react-dom"),n=require("../../hooks/use-active-press.js"),u=require("../../hooks/use-did-element-move.js"),o=require("../../hooks/use-disposables.js"),i=require("../../hooks/use-element-size.js"),a=require("../../hooks/use-event.js"),l=require("../../hooks/use-inert-others.js"),c=require("../../hooks/use-iso-morphic-effect.js"),d=require("../../hooks/use-on-disappear.js"),m=require("../../hooks/use-outside-click.js"),p=require("../../hooks/use-owner.js"),f=require("../../hooks/use-resolve-button-type.js"),v=require("../../hooks/use-scroll-lock.js"),I=require("../../hooks/use-sync-refs.js"),y=require("../../hooks/use-text-value.js"),h=require("../../hooks/use-tracked-pointer.js"),b=require("../../hooks/use-transition.js"),E=require("../../hooks/use-tree-walker.js"),g=require("../../internal/floating.js"),S=require("../../internal/open-closed.js"),x=require("../../utils/bugs.js"),R=require("../../utils/calculate-active-index.js"),P=require("../../utils/disposables.js"),F=require("../../utils/focus-management.js"),M=require("../../utils/match.js"),k=require("../../utils/render.js"),j=require("../description/description.js"),q=require("../keyboard.js"),D=require("../label/label.js"),w=require("../portal/portal.js");function T(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var A,K,C=T(t),_=((K=_||{})[K.Open=0]="Open",K[K.Closed=1]="Closed",K),O=(e=>(e[e.Pointer=0]="Pointer",e[e.Other=1]="Other",e))(O||{}),L=((A=L||{})[A.OpenMenu=0]="OpenMenu",A[A.CloseMenu=1]="CloseMenu",A[A.GoToItem=2]="GoToItem",A[A.Search=3]="Search",A[A.ClearSearch=4]="ClearSearch",A[A.RegisterItem=5]="RegisterItem",A[A.UnregisterItem=6]="UnregisterItem",A[A.SetButtonElement=7]="SetButtonElement",A[A.SetItemsElement=8]="SetItemsElement",A);function N(e,t=(e=>e)){let r=null!==e.activeItemIndex?e.items[e.activeItemIndex]:null,s=F.sortByDomNode(t(e.items.slice()),(e=>e.dataRef.current.domRef.current)),n=r?s.indexOf(r):null;return-1===n&&(n=null),{items:s,activeItemIndex:n}}let Q={1:e=>1===e.menuState?e:{...e,activeItemIndex:null,menuState:1},0:e=>0===e.menuState?e:{...e,__demoMode:!1,menuState:0},2:(e,t)=>{var r,s,n,u,o;if(1===e.menuState)return e;let i={...e,searchQuery:"",activationTrigger:null!=(r=t.trigger)?r:1,__demoMode:!1};if(t.focus===R.Focus.Nothing)return{...i,activeItemIndex:null};if(t.focus===R.Focus.Specific)return{...i,activeItemIndex:e.items.findIndex((e=>e.id===t.id))};if(t.focus===R.Focus.Previous){let r=e.activeItemIndex;if(null!==r){let u=e.items[r].dataRef.current.domRef,o=R.calculateActiveIndex(t,{resolveItems:()=>e.items,resolveActiveIndex:()=>e.activeItemIndex,resolveId:e=>e.id,resolveDisabled:e=>e.dataRef.current.disabled});if(null!==o){let t=e.items[o].dataRef.current.domRef;if((null==(s=u.current)?void 0:s.previousElementSibling)===t.current||null===(null==(n=t.current)?void 0:n.previousElementSibling))return{...i,activeItemIndex:o}}}}else if(t.focus===R.Focus.Next){let r=e.activeItemIndex;if(null!==r){let s=e.items[r].dataRef.current.domRef,n=R.calculateActiveIndex(t,{resolveItems:()=>e.items,resolveActiveIndex:()=>e.activeItemIndex,resolveId:e=>e.id,resolveDisabled:e=>e.dataRef.current.disabled});if(null!==n){let t=e.items[n].dataRef.current.domRef;if((null==(u=s.current)?void 0:u.nextElementSibling)===t.current||null===(null==(o=t.current)?void 0:o.nextElementSibling))return{...i,activeItemIndex:n}}}}let a=N(e),l=R.calculateActiveIndex(t,{resolveItems:()=>a.items,resolveActiveIndex:()=>a.activeItemIndex,resolveId:e=>e.id,resolveDisabled:e=>e.dataRef.current.disabled});return{...i,...a,activeItemIndex:l}},3:(e,t)=>{let r=""!==e.searchQuery?0:1,s=e.searchQuery+t.value.toLowerCase(),n=(null!==e.activeItemIndex?e.items.slice(e.activeItemIndex+r).concat(e.items.slice(0,e.activeItemIndex+r)):e.items).find((e=>{var t;return(null==(t=e.dataRef.current.textValue)?void 0:t.startsWith(s))&&!e.dataRef.current.disabled})),u=n?e.items.indexOf(n):-1;return-1===u||u===e.activeItemIndex?{...e,searchQuery:s}:{...e,searchQuery:s,activeItemIndex:u,activationTrigger:1}},4:e=>""===e.searchQuery?e:{...e,searchQuery:"",searchActiveItemIndex:null},5:(e,t)=>{let r=N(e,(e=>[...e,{id:t.id,dataRef:t.dataRef}]));return{...e,...r}},6:(e,t)=>{let r=N(e,(e=>{let r=e.findIndex((e=>e.id===t.id));return-1!==r&&e.splice(r,1),e}));return{...e,...r,activationTrigger:1}},7:(e,t)=>e.buttonElement===t.element?e:{...e,buttonElement:t.element},8:(e,t)=>e.itemsElement===t.element?e:{...e,itemsElement:t.element}},W=t.createContext(null);function B(e){let r=t.useContext(W);if(null===r){let t=new Error(`<${e} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,B),t}return r}function H(e,t){return M.match(t.type,Q,e,t)}W.displayName="MenuContext";let U=t.Fragment;let V=k.RenderFeatures.RenderStrategy|k.RenderFeatures.Static;let $=t.Fragment;let z=k.forwardRefWithAs((function(e,r){let{__demoMode:s=!1,...n}=e,u=t.useReducer(H,{__demoMode:s,menuState:s?0:1,buttonElement:null,itemsElement:null,items:[],searchQuery:"",activeItemIndex:null,activationTrigger:1}),[{menuState:o,itemsElement:i,buttonElement:l},c]=u,d=I.useSyncRefs(r);m.useOutsideClick(0===o,[l,i],((e,t)=>{c({type:1}),F.isFocusableElement(t,F.FocusableMode.Loose)||(e.preventDefault(),null==l||l.focus())}));let p=a.useEvent((()=>{c({type:1})})),f=t.useMemo((()=>({open:0===o,close:p})),[o,p]),v={ref:d},y=k.useRender();return C.default.createElement(g.FloatingProvider,null,C.default.createElement(W.Provider,{value:u},C.default.createElement(S.OpenClosedProvider,{value:M.match(o,{0:S.State.Open,1:S.State.Closed})},y({ourProps:v,theirProps:n,slot:f,defaultTag:U,name:"Menu"}))))})),G=k.forwardRefWithAs((function(u,o){var i;let l=t.useId(),{id:c=`headlessui-menu-button-${l}`,disabled:d=!1,autoFocus:m=!1,...p}=u,[v,y]=B("Menu.Button"),h=g.useFloatingReferenceProps(),b=I.useSyncRefs(o,g.useFloatingReference(),a.useEvent((e=>y({type:7,element:e})))),E=a.useEvent((e=>{switch(e.key){case q.Keys.Space:case q.Keys.Enter:case q.Keys.ArrowDown:e.preventDefault(),e.stopPropagation(),s.flushSync((()=>y({type:0}))),y({type:2,focus:R.Focus.First});break;case q.Keys.ArrowUp:e.preventDefault(),e.stopPropagation(),s.flushSync((()=>y({type:0}))),y({type:2,focus:R.Focus.Last})}})),S=a.useEvent((e=>{if(e.key===q.Keys.Space)e.preventDefault()})),P=a.useEvent((e=>{var t;if(x.isDisabledReactIssue7711(e.currentTarget))return e.preventDefault();d||(0===v.menuState?(s.flushSync((()=>y({type:1}))),null==(t=v.buttonElement)||t.focus({preventScroll:!0})):(e.preventDefault(),y({type:0})))})),{isFocusVisible:F,focusProps:M}=e.useFocusRing({autoFocus:m}),{isHovered:j,hoverProps:D}=r.useHover({isDisabled:d}),{pressed:w,pressProps:T}=n.useActivePress({disabled:d}),A=t.useMemo((()=>({open:0===v.menuState,active:w||0===v.menuState,disabled:d,hover:j,focus:F,autofocus:m})),[v,j,F,w,d,m]),K=k.mergeProps(h(),{ref:b,id:c,type:f.useResolveButtonType(u,v.buttonElement),"aria-haspopup":"menu","aria-controls":null==(i=v.itemsElement)?void 0:i.id,"aria-expanded":0===v.menuState,disabled:d||void 0,autoFocus:m,onKeyDown:E,onKeyUp:S,onClick:P},M,D,T);return k.useRender()({ourProps:K,theirProps:p,slot:A,defaultTag:"button",name:"Menu.Button"})})),J=k.forwardRefWithAs((function(e,r){var n,c;let m=t.useId(),{id:f=`headlessui-menu-items-${m}`,anchor:y,portal:h=!1,modal:x=!0,transition:P=!1,...M}=e,j=g.useResolvedAnchor(y),[D,T]=B("Menu.Items"),[A,K]=g.useFloatingPanel(j),_=g.useFloatingPanelProps(),[O,L]=t.useState(null),N=I.useSyncRefs(r,j?A:null,a.useEvent((e=>T({type:8,element:e}))),L),Q=p.useOwnerDocument(D.itemsElement);j&&(h=!0);let W=S.useOpenClosed(),[H,U]=b.useTransition(P,O,null!==W?(W&S.State.Open)===S.State.Open:0===D.menuState);d.useOnDisappear(H,D.buttonElement,(()=>{T({type:1})}));let $=!D.__demoMode&&(x&&0===D.menuState);v.useScrollLock($,Q);let z=!D.__demoMode&&(x&&0===D.menuState);l.useInertOthers(z,{allowed:t.useCallback((()=>[D.buttonElement,D.itemsElement]),[D.buttonElement,D.itemsElement])});let G=0!==D.menuState,J=!u.useDidElementMove(G,D.buttonElement)&&H;t.useEffect((()=>{let e=D.itemsElement;e&&0===D.menuState&&e!==(null==Q?void 0:Q.activeElement)&&e.focus({preventScroll:!0})}),[D.menuState,D.itemsElement,Q]),E.useTreeWalker(0===D.menuState,{container:D.itemsElement,accept:e=>"menuitem"===e.getAttribute("role")?NodeFilter.FILTER_REJECT:e.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT,walk(e){e.setAttribute("role","none")}});let X=o.useDisposables(),Y=a.useEvent((e=>{var t,r,n;switch(X.dispose(),e.key){case q.Keys.Space:if(""!==D.searchQuery)return e.preventDefault(),e.stopPropagation(),T({type:3,value:e.key});case q.Keys.Enter:if(e.preventDefault(),e.stopPropagation(),T({type:1}),null!==D.activeItemIndex){let{dataRef:e}=D.items[D.activeItemIndex];null==(r=null==(t=e.current)?void 0:t.domRef.current)||r.click()}F.restoreFocusIfNecessary(D.buttonElement);break;case q.Keys.ArrowDown:return e.preventDefault(),e.stopPropagation(),T({type:2,focus:R.Focus.Next});case q.Keys.ArrowUp:return e.preventDefault(),e.stopPropagation(),T({type:2,focus:R.Focus.Previous});case q.Keys.Home:case q.Keys.PageUp:return e.preventDefault(),e.stopPropagation(),T({type:2,focus:R.Focus.First});case q.Keys.End:case q.Keys.PageDown:return e.preventDefault(),e.stopPropagation(),T({type:2,focus:R.Focus.Last});case q.Keys.Escape:e.preventDefault(),e.stopPropagation(),s.flushSync((()=>T({type:1}))),null==(n=D.buttonElement)||n.focus({preventScroll:!0});break;case q.Keys.Tab:e.preventDefault(),e.stopPropagation(),s.flushSync((()=>T({type:1}))),F.focusFrom(D.buttonElement,e.shiftKey?F.Focus.Previous:F.Focus.Next);break;default:1===e.key.length&&(T({type:3,value:e.key}),X.setTimeout((()=>T({type:4})),350))}})),Z=a.useEvent((e=>{if(e.key===q.Keys.Space)e.preventDefault()})),ee=t.useMemo((()=>({open:0===D.menuState})),[D.menuState]),te=k.mergeProps(j?_():{},{"aria-activedescendant":null===D.activeItemIndex||null==(n=D.items[D.activeItemIndex])?void 0:n.id,"aria-labelledby":null==(c=D.buttonElement)?void 0:c.id,id:f,onKeyDown:Y,onKeyUp:Z,role:"menu",tabIndex:0===D.menuState?0:void 0,ref:N,style:{...M.style,...K,"--button-width":i.useElementSize(D.buttonElement,!0).width},...b.transitionDataAttributes(U)}),re=k.useRender();return C.default.createElement(w.Portal,{enabled:!!h&&(e.static||H)},re({ourProps:te,theirProps:M,slot:ee,defaultTag:"div",features:V,visible:J,name:"Menu.Items"}))})),X=k.forwardRefWithAs((function(e,r){let s=t.useId(),{id:n=`headlessui-menu-item-${s}`,disabled:u=!1,...o}=e,[i,l]=B("Menu.Item"),d=null!==i.activeItemIndex&&i.items[i.activeItemIndex].id===n,m=t.useRef(null),p=I.useSyncRefs(r,m);c.useIsoMorphicEffect((()=>{if(!i.__demoMode&&0===i.menuState&&d&&0!==i.activationTrigger)return P.disposables().requestAnimationFrame((()=>{var e,t;null==(t=null==(e=m.current)?void 0:e.scrollIntoView)||t.call(e,{block:"nearest"})}))}),[i.__demoMode,m,d,i.menuState,i.activationTrigger,i.activeItemIndex]);let f=y.useTextValue(m),v=t.useRef({disabled:u,domRef:m,get textValue(){return f()}});c.useIsoMorphicEffect((()=>{v.current.disabled=u}),[v,u]),c.useIsoMorphicEffect((()=>(l({type:5,id:n,dataRef:v}),()=>l({type:6,id:n}))),[v,n]);let b=a.useEvent((()=>{l({type:1})})),E=a.useEvent((e=>{if(u)return e.preventDefault();l({type:1}),F.restoreFocusIfNecessary(i.buttonElement)})),g=a.useEvent((()=>{if(u)return l({type:2,focus:R.Focus.Nothing});l({type:2,focus:R.Focus.Specific,id:n})})),S=h.useTrackedPointer(),x=a.useEvent((e=>{S.update(e),!u&&(d||l({type:2,focus:R.Focus.Specific,id:n,trigger:0}))})),M=a.useEvent((e=>{S.wasMoved(e)&&(u||d||l({type:2,focus:R.Focus.Specific,id:n,trigger:0}))})),q=a.useEvent((e=>{S.wasMoved(e)&&(u||d&&l({type:2,focus:R.Focus.Nothing}))})),[w,T]=D.useLabels(),[A,K]=j.useDescriptions(),_=t.useMemo((()=>({active:d,focus:d,disabled:u,close:b})),[d,u,b]),O={id:n,ref:p,role:"menuitem",tabIndex:!0===u?void 0:-1,"aria-disabled":!0===u||void 0,"aria-labelledby":w,"aria-describedby":A,disabled:void 0,onClick:E,onFocus:g,onPointerEnter:x,onMouseEnter:x,onPointerMove:M,onMouseMove:M,onPointerLeave:q,onMouseLeave:q},L=k.useRender();return C.default.createElement(T,null,C.default.createElement(K,null,L({ourProps:O,theirProps:o,slot:_,defaultTag:$,name:"Menu.Item"})))})),Y=k.forwardRefWithAs((function(e,t){let[r,s]=D.useLabels(),n=e,u={ref:t,"aria-labelledby":r,role:"group"},o=k.useRender();return C.default.createElement(s,null,o({ourProps:u,theirProps:n,slot:{},defaultTag:"div",name:"Menu.Section"}))})),Z=k.forwardRefWithAs((function(e,r){let s=t.useId(),{id:n=`headlessui-menu-heading-${s}`,...u}=e,o=D.useLabelContext();c.useIsoMorphicEffect((()=>o.register(n)),[n,o.register]);let i={id:n,ref:r,role:"presentation",...o.props};return k.useRender()({ourProps:i,theirProps:u,slot:{},defaultTag:"header",name:"Menu.Heading"})})),ee=k.forwardRefWithAs((function(e,t){let r=e,s={ref:t,role:"separator"};return k.useRender()({ourProps:s,theirProps:r,slot:{},defaultTag:"div",name:"Menu.Separator"})})),te=Object.assign(z,{Button:G,Items:J,Item:X,Section:Y,Heading:Z,Separator:ee});exports.Menu=te,exports.MenuButton=G,exports.MenuHeading=Z,exports.MenuItem=X,exports.MenuItems=J,exports.MenuSection=Y,exports.MenuSeparator=ee;
//# sourceMappingURL=menu.js.map
