"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t,n=require("react"),i=require("../utils/disposables.js"),s=require("./use-disposables.js"),r=require("./use-flags.js"),o=require("./use-iso-morphic-effect.js");"undefined"!=typeof process&&"undefined"!=typeof globalThis&&"undefined"!=typeof Element&&"test"===(null==(e=null==process?void 0:process.env)?void 0:e.NODE_ENV)&&void 0===(null==(t=null==Element?void 0:Element.prototype)?void 0:t.getAnimations)&&(Element.prototype.getAnimations=function(){return console.warn(["Headless UI has polyfilled `Element.prototype.getAnimations` for your tests.","Please install a proper polyfill e.g. `jsdom-testing-mocks`, to silence these warnings.","","Example usage:","```js","import { mockAnimationsApi } from 'jsdom-testing-mocks'","mockAnimationsApi()","```"].join("\n")),[]});var l,a=((l=a||{})[l.None=0]="None",l[l.Closed=1]="Closed",l[l.Enter=2]="Enter",l[l.Leave=4]="Leave",l);exports.transitionDataAttributes=function(e){let t={};for(let n in e)!0===e[n]&&(t[`data-${n}`]="");return t},exports.useTransition=function(e,t,l,a){let[u,d]=n.useState(l),{hasFlag:p,addFlag:c,removeFlag:f}=r.useFlags(e&&u?3:0),m=n.useRef(!1),v=n.useRef(!1),g=s.useDisposables();return o.useIsoMorphicEffect((()=>{var n;if(e)return l&&d(!0),t?(null==(n=null==a?void 0:a.start)||n.call(a,l),function(e,{prepare:t,run:n,done:s,inFlight:r}){let o=i.disposables();return function(e,{inFlight:t,prepare:n}){if(null!=t&&t.current)return void n();let i=e.style.transition;e.style.transition="none",n(),e.offsetHeight,e.style.transition=i}(e,{prepare:t,inFlight:r}),o.nextFrame((()=>{n(),o.requestAnimationFrame((()=>{o.add(function(e,t){var n,s;let r=i.disposables();if(!e)return r.dispose;let o=!1;r.add((()=>{o=!0}));let l=null!=(s=null==(n=e.getAnimations)?void 0:n.call(e).filter((e=>e instanceof CSSTransition)))?s:[];return 0===l.length?(t(),r.dispose):(Promise.allSettled(l.map((e=>e.finished))).then((()=>{o||t()})),r.dispose)}(e,s))}))})),o.dispose}(t,{inFlight:m,prepare(){v.current?v.current=!1:v.current=m.current,m.current=!0,!v.current&&(l?(c(3),f(4)):(c(4),f(2)))},run(){v.current?l?(f(3),c(4)):(f(4),c(3)):l?f(1):c(1)},done(){var e;v.current&&"function"==typeof t.getAnimations&&t.getAnimations().length>0||(m.current=!1,f(7),l||d(!1),null==(e=null==a?void 0:a.end)||e.call(a,l))}})):void(l&&c(3))}),[e,l,t,g]),e?[u,{closed:p(1),enter:p(2),leave:p(4),transition:p(2)||p(4)}]:[l,{closed:void 0,enter:void 0,leave:void 0,transition:void 0}]};
//# sourceMappingURL=use-transition.js.map
