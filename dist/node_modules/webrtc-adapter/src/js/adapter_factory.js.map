{"version":3,"file":"adapter_factory.js","sources":["../../../../../node_modules/webrtc-adapter/src/js/adapter_factory.js"],"sourcesContent":["/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\nimport * as utils from './utils';\n\n// Browser shims.\nimport * as chromeShim from './chrome/chrome_shim';\nimport * as firefoxShim from './firefox/firefox_shim';\nimport * as safariShim from './safari/safari_shim';\nimport * as commonShim from './common_shim';\nimport * as sdp from 'sdp';\n\n// Shimming starts here.\nexport function adapterFactory({window} = {}, options = {\n  shimChrome: true,\n  shimFirefox: true,\n  shimSafari: true,\n}) {\n  // Utils.\n  const logging = utils.log;\n  const browserDetails = utils.detectBrowser(window);\n\n  const adapter = {\n    browserDetails,\n    commonShim,\n    extractVersion: utils.extractVersion,\n    disableLog: utils.disableLog,\n    disableWarnings: utils.disableWarnings,\n    // Expose sdp as a convenience. For production apps include directly.\n    sdp,\n  };\n\n  // Shim browser if found.\n  switch (browserDetails.browser) {\n    case 'chrome':\n      if (!chromeShim || !chromeShim.shimPeerConnection ||\n          !options.shimChrome) {\n        logging('Chrome shim is not included in this adapter release.');\n        return adapter;\n      }\n      if (browserDetails.version === null) {\n        logging('Chrome shim can not determine version, not shimming.');\n        return adapter;\n      }\n      logging('adapter.js shimming chrome.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = chromeShim;\n\n      // Must be called before shimPeerConnection.\n      commonShim.shimAddIceCandidateNullOrEmpty(window, browserDetails);\n      commonShim.shimParameterlessSetLocalDescription(window, browserDetails);\n\n      chromeShim.shimGetUserMedia(window, browserDetails);\n      chromeShim.shimMediaStream(window, browserDetails);\n      chromeShim.shimPeerConnection(window, browserDetails);\n      chromeShim.shimOnTrack(window, browserDetails);\n      chromeShim.shimAddTrackRemoveTrack(window, browserDetails);\n      chromeShim.shimGetSendersWithDtmf(window, browserDetails);\n      chromeShim.shimSenderReceiverGetStats(window, browserDetails);\n      chromeShim.fixNegotiationNeeded(window, browserDetails);\n\n      commonShim.shimRTCIceCandidate(window, browserDetails);\n      commonShim.shimRTCIceCandidateRelayProtocol(window, browserDetails);\n      commonShim.shimConnectionState(window, browserDetails);\n      commonShim.shimMaxMessageSize(window, browserDetails);\n      commonShim.shimSendThrowTypeError(window, browserDetails);\n      commonShim.removeExtmapAllowMixed(window, browserDetails);\n      break;\n    case 'firefox':\n      if (!firefoxShim || !firefoxShim.shimPeerConnection ||\n          !options.shimFirefox) {\n        logging('Firefox shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming firefox.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = firefoxShim;\n\n      // Must be called before shimPeerConnection.\n      commonShim.shimAddIceCandidateNullOrEmpty(window, browserDetails);\n      commonShim.shimParameterlessSetLocalDescription(window, browserDetails);\n\n      firefoxShim.shimGetUserMedia(window, browserDetails);\n      firefoxShim.shimPeerConnection(window, browserDetails);\n      firefoxShim.shimOnTrack(window, browserDetails);\n      firefoxShim.shimRemoveStream(window, browserDetails);\n      firefoxShim.shimSenderGetStats(window, browserDetails);\n      firefoxShim.shimReceiverGetStats(window, browserDetails);\n      firefoxShim.shimRTCDataChannel(window, browserDetails);\n      firefoxShim.shimAddTransceiver(window, browserDetails);\n      firefoxShim.shimGetParameters(window, browserDetails);\n      firefoxShim.shimCreateOffer(window, browserDetails);\n      firefoxShim.shimCreateAnswer(window, browserDetails);\n\n      commonShim.shimRTCIceCandidate(window, browserDetails);\n      commonShim.shimConnectionState(window, browserDetails);\n      commonShim.shimMaxMessageSize(window, browserDetails);\n      commonShim.shimSendThrowTypeError(window, browserDetails);\n      break;\n    case 'safari':\n      if (!safariShim || !options.shimSafari) {\n        logging('Safari shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming safari.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = safariShim;\n\n      // Must be called before shimCallbackAPI.\n      commonShim.shimAddIceCandidateNullOrEmpty(window, browserDetails);\n      commonShim.shimParameterlessSetLocalDescription(window, browserDetails);\n\n      safariShim.shimRTCIceServerUrls(window, browserDetails);\n      safariShim.shimCreateOfferLegacy(window, browserDetails);\n      safariShim.shimCallbacksAPI(window, browserDetails);\n      safariShim.shimLocalStreamsAPI(window, browserDetails);\n      safariShim.shimRemoteStreamsAPI(window, browserDetails);\n      safariShim.shimTrackEventTransceiver(window, browserDetails);\n      safariShim.shimGetUserMedia(window, browserDetails);\n      safariShim.shimAudioContext(window, browserDetails);\n\n      commonShim.shimRTCIceCandidate(window, browserDetails);\n      commonShim.shimRTCIceCandidateRelayProtocol(window, browserDetails);\n      commonShim.shimMaxMessageSize(window, browserDetails);\n      commonShim.shimSendThrowTypeError(window, browserDetails);\n      commonShim.removeExtmapAllowMixed(window, browserDetails);\n      break;\n    default:\n      logging('Unsupported browser!');\n      break;\n  }\n\n  return adapter;\n}\n"],"names":["window","options","shimChrome","shimFirefox","shimSafari","logging","utils","browserDetails","adapter","commonShim","extractVersion","disableLog","disableWarnings","sdp","browser","chromeShim","shimPeerConnection","version","browserShim","shimParameterlessSetLocalDescription","shimMediaStream","shimOnTrack","shimGetSendersWithDtmf","shimSenderReceiverGetStats","shimRTCIceCandidate","shimRTCIceCandidateRelayProtocol","shimConnectionState","shimSendThrowTypeError","firefoxShim","shimRemoveStream","shimSenderGetStats","shimReceiverGetStats","shimRTCDataChannel","shimAddTransceiver","shimGetParameters","shimCreateOffer","shimCreateAnswer","safariShim","shimRTCIceServerUrls","shimCreateOfferLegacy","shimCallbacksAPI","shimLocalStreamsAPI","shimRemoteStreamsAPI","shimTrackEventTransceiver","shimGetUserMedia","shimAudioContext"],"mappings":"oXAiBO,UAAwBA,OAACA,GAAU,CAAA,EAAIC,EAAU,CACtDC,YAAY,EACZC,aAAa,EACbC,YAAY,IAGZ,MAAMC,EAAUC,EAAAA,IACVC,EAAiBD,gBAAoBN,GAErCQ,EAAU,CACdD,4BACAE,EACAC,eAAgBJ,EAAoBI,eACpCC,WAAYL,EAAgBK,WAC5BC,gBAAiBN,EAAqBM,gBAEtCC,OAIF,OAAQN,EAAeO,SACrB,IAAK,SACH,IAAKC,IAAeA,EAA6BC,qBAC5Cf,EAAQC,WAEX,OADAG,EAAQ,wDACDG,EAET,GAA+B,OAA3BD,EAAeU,QAEjB,OADAZ,EAAQ,wDACDG,EAETH,EAAQ,+BAERG,EAAQU,YAAcH,EAGtBN,iCAA0CT,EAAQO,GAClDE,EAA+CU,qCAACnB,GAEhDe,mBAA4Bf,EAAQO,GACpCQ,EAA0BK,gBAACpB,GAC3Be,qBAA8Bf,EAAQO,GACtCQ,EAAsBM,YAACrB,GACvBe,0BAAmCf,EAAQO,GAC3CQ,EAAiCO,uBAACtB,GAClCe,EAAqCQ,2BAACvB,GACtCe,uBAAgCf,EAAQO,GAExCE,EAA8Be,oBAACxB,GAC/BS,EAA2CgB,iCAACzB,GAC5CS,EAA8BiB,oBAAC1B,GAC/BS,qBAA8BT,EAAQO,GACtCE,EAAiCkB,uBAAC3B,GAClCS,yBAAkCT,EAAQO,GAC1C,MACF,IAAK,UACH,IAAKqB,IAAgBA,EAA8BZ,qBAC9Cf,EAAQE,YAEX,OADAE,EAAQ,yDACDG,EAETH,EAAQ,gCAERG,EAAQU,YAAcU,EAGtBnB,iCAA0CT,EAAQO,GAClDE,EAA+CU,qCAACnB,GAEhD4B,mBAA6B5B,EAAQO,GACrCqB,qBAA+B5B,EAAQO,GACvCqB,EAAuBP,YAACrB,GACxB4B,EAA4BC,iBAAC7B,GAC7B4B,EAA8BE,mBAAC9B,GAC/B4B,EAAgCG,qBAAC/B,GACjC4B,EAA8BI,mBAAChC,GAC/B4B,EAA8BK,mBAACjC,GAC/B4B,EAA6BM,kBAAClC,GAC9B4B,EAA2BO,gBAACnC,GAC5B4B,EAA4BQ,iBAACpC,GAE7BS,EAA8Be,oBAACxB,GAC/BS,EAA8BiB,oBAAC1B,GAC/BS,qBAA8BT,EAAQO,GACtCE,EAAiCkB,uBAAC3B,GAClC,MACF,IAAK,SACH,IAAKqC,IAAepC,EAAQG,WAE1B,OADAC,EAAQ,wDACDG,EAETH,EAAQ,+BAERG,EAAQU,YAAcmB,EAGtB5B,iCAA0CT,EAAQO,GAClDE,EAA+CU,qCAACnB,GAEhDqC,EAA+BC,qBAACtC,GAChCqC,EAAgCE,sBAACvC,GACjCqC,EAA2BG,iBAACxC,GAC5BqC,EAA8BI,oBAACzC,GAC/BqC,EAA+BK,qBAAC1C,GAChCqC,EAAoCM,0BAAC3C,GACrCqC,EAA2BO,iBAAC5C,GAC5BqC,EAA2BQ,iBAAC7C,GAE5BS,EAA8Be,oBAACxB,GAC/BS,EAA2CgB,iCAACzB,GAC5CS,qBAA8BT,EAAQO,GACtCE,EAAiCkB,uBAAC3B,GAClCS,yBAAkCT,EAAQO,GAC1C,MACF,QACEF,EAAQ,wBAIZ,OAAOG,CACT"}