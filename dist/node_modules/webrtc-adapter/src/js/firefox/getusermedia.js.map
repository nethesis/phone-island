{"version":3,"file":"getusermedia.js","sources":["../../../../../../node_modules/webrtc-adapter/src/js/firefox/getusermedia.js"],"sourcesContent":["/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\n\nexport function shimGetUserMedia(window, browserDetails) {\n  const navigator = window && window.navigator;\n  const MediaStreamTrack = window && window.MediaStreamTrack;\n\n  navigator.getUserMedia = function(constraints, onSuccess, onError) {\n    // Replace Firefox 44+'s deprecation warning with unprefixed version.\n    utils.deprecated('navigator.getUserMedia',\n      'navigator.mediaDevices.getUserMedia');\n    navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\n  };\n\n  if (!(browserDetails.version > 55 &&\n      'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {\n    const remap = function(obj, a, b) {\n      if (a in obj && !(b in obj)) {\n        obj[b] = obj[a];\n        delete obj[a];\n      }\n    };\n\n    const nativeGetUserMedia = navigator.mediaDevices.getUserMedia.\n      bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      if (typeof c === 'object' && typeof c.audio === 'object') {\n        c = JSON.parse(JSON.stringify(c));\n        remap(c.audio, 'autoGainControl', 'mozAutoGainControl');\n        remap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');\n      }\n      return nativeGetUserMedia(c);\n    };\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {\n      const nativeGetSettings = MediaStreamTrack.prototype.getSettings;\n      MediaStreamTrack.prototype.getSettings = function() {\n        const obj = nativeGetSettings.apply(this, arguments);\n        remap(obj, 'mozAutoGainControl', 'autoGainControl');\n        remap(obj, 'mozNoiseSuppression', 'noiseSuppression');\n        return obj;\n      };\n    }\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {\n      const nativeApplyConstraints =\n        MediaStreamTrack.prototype.applyConstraints;\n      MediaStreamTrack.prototype.applyConstraints = function(c) {\n        if (this.kind === 'audio' && typeof c === 'object') {\n          c = JSON.parse(JSON.stringify(c));\n          remap(c, 'autoGainControl', 'mozAutoGainControl');\n          remap(c, 'noiseSuppression', 'mozNoiseSuppression');\n        }\n        return nativeApplyConstraints.apply(this, [c]);\n      };\n    }\n  }\n}\n"],"names":["window","browserDetails","navigator","MediaStreamTrack","getUserMedia","constraints","onSuccess","onError","utils","mediaDevices","then","version","getSupportedConstraints","remap","obj","a","b","nativeGetUserMedia","bind","c","audio","JSON","parse","stringify","prototype","getSettings","nativeGetSettings","apply","this","arguments","applyConstraints","nativeApplyConstraints","kind"],"mappings":"0HAYO,SAA0BA,EAAQC,GACvC,MAAMC,EAAYF,GAAUA,EAAOE,UAC7BC,EAAmBH,GAAUA,EAAOG,iBAS1C,GAPAD,EAAUE,aAAe,SAASC,EAAaC,EAAWC,GAExDC,aAAiB,yBACf,uCACFN,EAAUO,aAAaL,aAAaC,GAAaK,KAAKJ,EAAWC,MAG7DN,EAAeU,QAAU,IAC3B,oBAAqBT,EAAUO,aAAaG,2BAA4B,CAC1E,MAAMC,EAAQ,SAASC,EAAKC,EAAGC,GACzBD,KAAKD,KAASE,KAAKF,KACrBA,EAAIE,GAAKF,EAAIC,UACND,EAAIC,KAITE,EAAqBf,EAAUO,aAAaL,aAChDc,KAAKhB,EAAUO,cAUjB,GATAP,EAAUO,aAAaL,aAAe,SAASe,GAM7C,MALiB,iBAANA,GAAqC,iBAAZA,EAAEC,QACpCD,EAAIE,KAAKC,MAAMD,KAAKE,UAAUJ,IAC9BN,EAAMM,EAAEC,MAAO,kBAAmB,sBAClCP,EAAMM,EAAEC,MAAO,mBAAoB,wBAE9BH,EAAmBE,IAGxBhB,GAAoBA,EAAiBqB,UAAUC,YAAa,CAC9D,MAAMC,EAAoBvB,EAAiBqB,UAAUC,YACrDtB,EAAiBqB,UAAUC,YAAc,WACvC,MAAMX,EAAMY,EAAkBC,MAAMC,KAAMC,WAG1C,OAFAhB,EAAMC,EAAK,qBAAsB,mBACjCD,EAAMC,EAAK,sBAAuB,oBAC3BA,EAEX,CAEA,GAAIX,GAAoBA,EAAiBqB,UAAUM,iBAAkB,CACnE,MAAMC,EACJ5B,EAAiBqB,UAAUM,iBAC7B3B,EAAiBqB,UAAUM,iBAAmB,SAASX,GAMrD,MALkB,UAAdS,KAAKI,MAAiC,iBAANb,IAClCA,EAAIE,KAAKC,MAAMD,KAAKE,UAAUJ,IAC9BN,EAAMM,EAAG,kBAAmB,sBAC5BN,EAAMM,EAAG,mBAAoB,wBAExBY,EAAuBJ,MAAMC,KAAM,CAACT,IAE/C,CACF,CACF"}