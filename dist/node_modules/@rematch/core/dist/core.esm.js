"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../../../redux/es/redux.js");function n(){return n=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e},n.apply(this,arguments)}function r(n){var r;n.models.forEach((function(e){return t(n,e)}));var u=o(n),i=e.applyMiddleware.apply(e,n.reduxConfig.middlewares),c=n.reduxConfig.devtoolComposer?(r=n.reduxConfig).devtoolComposer.apply(r,n.reduxConfig.enhancers.concat([i])):function(n){void 0===n&&(n={});return!n.disabled&&"object"==typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__(n):e.compose}(n.reduxConfig.devtoolOptions).apply(void 0,n.reduxConfig.enhancers.concat([i])),d=n.reduxConfig.createStore||e.createStore,a=n.reduxConfig.initialState;return d(u,void 0===a?{}:a,c)}function t(e,n){var r={};Object.keys(n.reducers).forEach((function(e){var t=function(e){return e.indexOf("/")>-1}(e)?e:n.name+"/"+e;r[t]=n.reducers[e]}));var t=function(e,t){return void 0===e&&(e=n.state),t.type in r?r[t.type](e,t.payload,t.meta):e},o=n.baseReducer,u=o?function(e,r){return void 0===e&&(e=n.state),t(o(e,r),r)}:t;e.forEachPlugin("onReducer",(function(r){u=r(u,n.name,e)||u})),e.reduxConfig.reducers[n.name]=u}function o(n){var r=n.reduxConfig.rootReducers,t=function(n){var r=n.combineReducers||e.combineReducers;if(!Object.keys(n.reducers).length)return function(e){return e};return r(n.reducers)}(n.reduxConfig),o=t;return r&&Object.keys(r).length&&(o=function(e,n){var o=r[n.type];return t(o?o(e,n):e,n)}),n.forEachPlugin("onRootReducer",(function(e){o=e(o,n)||o})),o}var u=function(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)},i=function(e){return!e||"function"==typeof e},c=function(e){if("production"!==process.env.NODE_ENV){var n=e(),r=[];if(n.forEach((function(e){var n=e[0],t=e[1];n&&r.push(t)})),r.length>0)throw new Error(r.join(", "))}},d=function(e){c((function(){return[[!e,"model config is required"],["string"!=typeof e.name,'model "name" [string] is required'],[void 0===e.state&&void 0===e.baseReducer,'model "state" is required'],[!i(e.baseReducer),'model "baseReducer" must be a function']]}))},a=function(e,n,r,t){return Object.assign((function(t,o){var u={type:n+"/"+r};return void 0!==t&&(u.payload=t),void 0!==o&&(u.meta=o),e.dispatch(u)}),{isEffect:t})},f=function(e,n){var r=e.dispatch[n.name];Object.keys(n.reducers).forEach((function(t){!function(e,n,r){c((function(){return[[!!r.match(/\/.+\//),"Invalid reducer name ("+e+"/"+r+")"],["function"!=typeof n[r],"Invalid reducer ("+e+"/"+r+"). Must be a function"]]}))}(n.name,n.reducers,t),r[t]=a(e,n.name,t,!1)}))},s=function(e,n,r){var t=e.dispatch[r.name],o={};r.effects&&(o="function"==typeof r.effects?r.effects(e.dispatch):r.effects),Object.keys(o).forEach((function(u){!function(e,n,r){c((function(){return[[!!r.match(/\//),"Invalid effect name ("+e+"/"+r+")"],["function"!=typeof n[r],"Invalid effect ("+e+"/"+r+"). Must be a function"]]}))}(r.name,o,u),n.effects[r.name+"/"+u]=o[u].bind(t),t[u]=a(e,r.name,u,!0)}))};function l(e){return{models:(r=e.models,Object.keys(r).map((function(e){var t=function(e,r){return n({name:e,reducers:{}},r)}(e,r[e]);return d(t),t}))),reduxConfig:e.redux,forEachPlugin:function(n,r){e.plugins.forEach((function(e){e[n]&&r(e[n])}))},effects:{}};var r}function m(e){var u=l(e);u.reduxConfig.middlewares.push(function(e){return function(n){return function(r){return function(t){return t.type in e.effects?(r(t),e.effects[t.type](t.payload,n.getState(),t.meta)):r(t)}}}}(u)),u.forEachPlugin("createMiddleware",(function(e){u.reduxConfig.middlewares.push(e(u))}));var i,c=r(u),a=n({},c,{name:e.name,addModel:function(e){d(e),t(u,e),p(a,e),x(a,u,e),c.replaceReducer(o(u)),c.dispatch({type:"@@redux/REPLACE"})}});return i=a,e.plugins.forEach((function(e){e.exposed&&Object.keys(e.exposed).forEach((function(n){if(e.exposed){var r=e.exposed[n],t="function"==typeof r;i[n]=t?function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return r.apply(void 0,[i].concat(n))}:Object.create(e.exposed[n])}}))})),u.models.forEach((function(e){return p(a,e)})),u.models.forEach((function(e){return x(a,u,e)})),u.forEachPlugin("onStoreCreated",(function(e){a=e(a,u)||a})),a}function p(e,n){e.dispatch[""+n.name]={},f(e,n)}function x(e,n,r){s(e,n,r),n.forEachPlugin("onModel",(function(n){n(r,e)}))}var g=0;function v(e){var r,t,o,d=null!=(r=e.name)?r:"Rematch Store "+g;g+=1;var a={name:d,models:e.models||{},plugins:e.plugins||[],redux:n({reducers:{},rootReducers:{},enhancers:[],middlewares:[]},e.redux,{devtoolOptions:n({name:d},null!=(t=null==(o=e.redux)?void 0:o.devtoolOptions)?t:{})})};return function(e){c((function(){return[[!Array.isArray(e.plugins),"init config.plugins must be an array"],[!u(e.models),"init config.models must be an object"],[!u(e.redux.reducers),"init config.redux.reducers must be an object"],[!Array.isArray(e.redux.middlewares),"init config.redux.middlewares must be an array"],[!Array.isArray(e.redux.enhancers),"init config.redux.enhancers must be an array of functions"],[!i(e.redux.combineReducers),"init config.redux.combineReducers must be a function"],[!i(e.redux.createStore),"init config.redux.createStore must be a function"]]}))}(a),a.plugins.forEach((function(e){e.config&&(a.models=y(a.models,e.config.models),e.config.redux&&(a.redux.initialState=y(a.redux.initialState,e.config.redux.initialState),a.redux.reducers=y(a.redux.reducers,e.config.redux.reducers),a.redux.rootReducers=y(a.redux.rootReducers,e.config.redux.reducers),a.redux.enhancers=[].concat(a.redux.enhancers,e.config.redux.enhancers||[]),a.redux.middlewares=[].concat(a.redux.middlewares,e.config.redux.middlewares||[]),a.redux.combineReducers=a.redux.combineReducers||e.config.redux.combineReducers,a.redux.createStore=a.redux.createStore||e.config.redux.createStore)),function(e){c((function(){return[[!i(e.onStoreCreated),"Plugin onStoreCreated must be a function"],[!i(e.onModel),"Plugin onModel must be a function"],[!i(e.onReducer),"Plugin onReducer must be a function"],[!i(e.onRootReducer),"Plugin onRootReducer must be a function"],[!i(e.createMiddleware),"Plugin createMiddleware must be a function"]]}))}(e)})),a}function y(e,r){return r?n({},r,e):e}exports.createModel=function(){return function(e){return e}},exports.init=function(e){return m(v(e||{}))};
//# sourceMappingURL=core.esm.js.map
