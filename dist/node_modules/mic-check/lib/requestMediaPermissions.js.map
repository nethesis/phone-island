{"version":3,"file":"requestMediaPermissions.js","sources":["../../../../node_modules/mic-check/lib/requestMediaPermissions.js"],"sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.requestVideoPermissions = exports.requestAudioPermissions = exports.requestMediaPermissions = exports.MediaPermissionsErrorType = void 0;\nconst bowser_1 = __importDefault(require(\"bowser\"));\nvar MediaPermissionsErrorType;\n(function (MediaPermissionsErrorType) {\n    /** (macOS) browser does not have permission to access cam/mic */\n    MediaPermissionsErrorType[\"SystemPermissionDenied\"] = \"SystemPermissionDenied\";\n    /** user denied permission for site to access cam/mic */\n    MediaPermissionsErrorType[\"UserPermissionDenied\"] = \"UserPermissionDenied\";\n    /** (Windows) browser does not have permission to access cam/mic OR camera is in use by another application or browser tab */\n    MediaPermissionsErrorType[\"CouldNotStartVideoSource\"] = \"CouldNotStartVideoSource\";\n    /** all other errors */\n    MediaPermissionsErrorType[\"Generic\"] = \"Generic\";\n})(MediaPermissionsErrorType = exports.MediaPermissionsErrorType || (exports.MediaPermissionsErrorType = {}));\n/**\n * Request camera and mic permissions from the browser.\n * @returns\n */\nconst requestMediaPermissions = (constraints) => {\n    return new Promise((resolve, reject) => {\n        navigator.mediaDevices\n            .getUserMedia(constraints !== null && constraints !== void 0 ? constraints : { audio: true, video: true })\n            .then((stream) => {\n            stream.getTracks().forEach((t) => {\n                t.stop();\n            });\n            resolve(true);\n        })\n            .catch((err) => {\n            const browser = bowser_1.default.getParser(window.navigator.userAgent);\n            const browserName = browser.getBrowserName();\n            const errName = err.name;\n            const errMessage = err.message;\n            let errorType = MediaPermissionsErrorType.Generic;\n            if (browserName === 'Chrome') {\n                if (errName === 'NotAllowedError') {\n                    if (errMessage === 'Permission denied by system') {\n                        errorType =\n                            MediaPermissionsErrorType.SystemPermissionDenied;\n                    }\n                    else if (errMessage === 'Permission denied') {\n                        errorType =\n                            MediaPermissionsErrorType.UserPermissionDenied;\n                    }\n                }\n                else if (errName === 'NotReadableError') {\n                    errorType =\n                        MediaPermissionsErrorType.CouldNotStartVideoSource;\n                }\n            }\n            else if (browserName === 'Safari') {\n                if (errName === 'NotAllowedError') {\n                    errorType =\n                        MediaPermissionsErrorType.UserPermissionDenied;\n                }\n            }\n            else if (browserName === 'Microsoft Edge') {\n                if (errName === 'NotAllowedError') {\n                    errorType =\n                        MediaPermissionsErrorType.UserPermissionDenied;\n                }\n                else if (errName === 'NotReadableError') {\n                    errorType =\n                        MediaPermissionsErrorType.CouldNotStartVideoSource;\n                }\n            }\n            else if (browserName === 'Firefox') {\n                // https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia#exceptions\n                if (errName === 'NotFoundError') {\n                    errorType =\n                        MediaPermissionsErrorType.SystemPermissionDenied;\n                }\n                else if (errName === 'NotReadableError') {\n                    errorType =\n                        MediaPermissionsErrorType.SystemPermissionDenied;\n                }\n                else if (errName === 'NotAllowedError') {\n                    errorType =\n                        MediaPermissionsErrorType.UserPermissionDenied;\n                }\n                else if (errName === 'AbortError') {\n                    errorType =\n                        MediaPermissionsErrorType.CouldNotStartVideoSource;\n                }\n            }\n            reject({\n                type: errorType,\n                name: err.name,\n                message: err.message,\n            });\n            // Brave cannot be detected by the bowser library because they removed Brave from the User Agent to reduce fingerprinting\n            // https://github.com/brave/browser-laptop/blob/master/CHANGELOG.md#090\n        });\n    });\n};\nexports.requestMediaPermissions = requestMediaPermissions;\nconst requestAudioPermissions = () => (0, exports.requestMediaPermissions)({ audio: true, video: false });\nexports.requestAudioPermissions = requestAudioPermissions;\nconst requestVideoPermissions = () => (0, exports.requestMediaPermissions)({ audio: false, video: true });\nexports.requestVideoPermissions = requestVideoPermissions;\n"],"names":["__importDefault","this","commonjsGlobal","mod","__esModule","default","Object","defineProperty","exports","value","requestVideoPermissions","requestAudioPermissions","requestMediaPermissions","MediaPermissionsErrorType","bowser_1","require$$0","constraints","Promise","resolve","reject","navigator","mediaDevices","getUserMedia","audio","video","then","stream","getTracks","forEach","t","stop","catch","err","browserName","getParser","window","userAgent","getBrowserName","errName","name","errMessage","message","errorType","Generic","SystemPermissionDenied","UserPermissionDenied","CouldNotStartVideoSource","type"],"mappings":"oNACA,IAAIA,EAAmBC,EAAIC,gBAAID,EAAIC,eAACF,iBAAoB,SAAUG,GAC9D,OAAQA,GAAOA,EAAIC,WAAcD,EAAM,CAAEE,QAAWF,IAExDG,OAAOC,eAAcC,EAAU,aAAc,CAAEC,OAAO,IACtDD,EAAAE,wBAAkCF,EAAkCG,wBAAAH,EAAAI,wBAAkCJ,EAAoCK,+BAAA,EAC1I,MAAMC,EAAWd,EAAgBe,EAAAA,IAAAA,SACjC,IAAIF,GACJ,SAAWA,GAEPA,EAAkD,uBAAI,yBAEtDA,EAAgD,qBAAI,uBAEpDA,EAAoD,yBAAI,2BAExDA,EAAmC,QAAI,SAC1C,CATD,CASGA,EAA4BL,EAAQK,4BAA8BL,EAAoCK,0BAAA,CAAE,IAkF3GL,EAAAI,wBA7EiCI,GACtB,IAAIC,SAAQ,CAACC,EAASC,KACzBC,UAAUC,aACLC,aAAaN,QAAiDA,EAAc,CAAEO,OAAO,EAAMC,OAAO,IAClGC,MAAMC,IACPA,EAAOC,YAAYC,SAASC,IACxBA,EAAEC,MAAM,IAEZZ,GAAQ,EAAK,IAEZa,OAAOC,IACR,MACMC,EADUnB,EAAST,QAAQ6B,UAAUC,OAAOf,UAAUgB,WAChCC,iBACtBC,EAAUN,EAAIO,KACdC,EAAaR,EAAIS,QACvB,IAAIC,EAAY7B,EAA0B8B,QACtB,WAAhBV,EACgB,oBAAZK,EACmB,gCAAfE,EACAE,EACI7B,EAA0B+B,uBAEV,sBAAfJ,IACLE,EACI7B,EAA0BgC,sBAGjB,qBAAZP,IACLI,EACI7B,EAA0BiC,0BAGb,WAAhBb,EACW,oBAAZK,IACAI,EACI7B,EAA0BgC,sBAGb,mBAAhBZ,EACW,oBAAZK,EACAI,EACI7B,EAA0BgC,qBAEb,qBAAZP,IACLI,EACI7B,EAA0BiC,0BAGb,YAAhBb,IAEW,kBAAZK,GAIiB,qBAAZA,EAHLI,EACI7B,EAA0B+B,uBAMb,oBAAZN,EACLI,EACI7B,EAA0BgC,qBAEb,eAAZP,IACLI,EACI7B,EAA0BiC,2BAGtC3B,EAAO,CACH4B,KAAML,EACNH,KAAMP,EAAIO,KACVE,QAAST,EAAIS,SACf,GAGJ,IAKVjC,EAAAG,wBADgCA,KAAM,EAAIH,EAAQI,yBAAyB,CAAEW,OAAO,EAAMC,OAAO,IAGjGhB,EAAAE,wBADgCA,KAAM,EAAIF,EAAQI,yBAAyB,CAAEW,OAAO,EAAOC,OAAO"}