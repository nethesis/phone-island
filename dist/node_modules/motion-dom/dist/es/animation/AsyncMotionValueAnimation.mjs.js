"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../frameloop/sync-time.mjs.js"),i=require("./JSAnimation.mjs.js"),t=require("./keyframes/get-final.mjs.js"),n=require("./keyframes/KeyframesResolver.mjs.js"),s=require("./NativeAnimationExtended.mjs.js"),a=require("./utils/can-animate.mjs.js"),o=require("./utils/WithPromise.mjs.js"),r=require("./waapi/supports/waapi.mjs.js"),m=require("../../../../motion-utils/dist/es/global-config.mjs.js"),l=require("../../../../motion-utils/dist/es/noop.mjs.js");class h extends o.WithPromise{constructor({autoplay:i=!0,delay:t=0,type:s="keyframes",repeat:a=0,repeatDelay:o=0,repeatType:r="loop",keyframes:m,name:l,motionValue:h,element:p,...d}){super(),this.stop=()=>{this._animation?(this._animation.stop(),this.stopTimeline?.()):this.keyframeResolver?.cancel()},this.createdAt=e.time.now();const u={autoplay:i,delay:t,type:s,repeat:a,repeatDelay:o,repeatType:r,name:l,motionValue:h,element:p,...d},y=p?.KeyframeResolver||n.KeyframeResolver;this.keyframeResolver=new y(m,((e,i,t)=>this.onKeyframesResolved(e,i,u,!t)),l,h,p),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(n,o,h,p){this.keyframeResolver=void 0;const{name:d,type:u,velocity:y,delay:f,isHandoff:c,onUpdate:v}=h;this.resolvedAt=e.time.now(),a.canAnimate(n,d,u,y)||(!m.MotionGlobalConfig.instantAnimations&&f||v?.(t.getFinalKeyframe(n,h,o)),n[0]=n[n.length-1],h.duration=0,h.repeat=0);const j={startTime:p?this.resolvedAt&&this.resolvedAt-this.createdAt>40?this.resolvedAt:this.createdAt:void 0,finalKeyframe:o,...h,keyframes:n},g=!c&&r.supportsBrowserAnimation(j)?new s.NativeAnimationExtended({...j,element:j.motionValue.owner.current}):new i.JSAnimation(j);g.finished.then((()=>this.notifyFinished())).catch(l.noop),this.pendingTimeline&&(this.stopTimeline=g.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=g}get finished(){return this._animation?this.animation.finished:this._finished}then(e,i){return this.finished.finally(e).then((()=>{}))}get animation(){return this._animation||n.flushKeyframeResolvers(),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this.animation.cancel()}}exports.AsyncMotionValueAnimation=h;
//# sourceMappingURL=AsyncMotionValueAnimation.mjs.js.map
