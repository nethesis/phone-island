"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../../waapi/utils/linear.mjs.js"),s=require("../utils/calc-duration.mjs.js"),t=require("../utils/create-generator-easing.mjs.js"),n=require("../utils/velocity.mjs.js"),a=require("./defaults.mjs.js"),r=require("./find.mjs.js"),i=require("../../../../../../motion-utils/dist/es/time-conversion.mjs.js"),o=require("../../../../../../motion-utils/dist/es/clamp.mjs.js");const l=["duration","bounce"],u=["stiffness","damping","mass"];function c(e,s){return s.some((s=>void 0!==e[s]))}function f(t=a.springDefaults.visualDuration,f=a.springDefaults.bounce){const m="object"!=typeof t?{visualDuration:t,keyframes:[0,1],bounce:f}:t;let{restSpeed:d,restDelta:p}=m;const g=m.keyframes[0],D=m.keyframes[m.keyframes.length-1],h={done:!1,value:g},{stiffness:v,damping:M,mass:j,duration:y,velocity:q,isResolvedFromDuration:b}=function(e){let s={velocity:a.springDefaults.velocity,stiffness:a.springDefaults.stiffness,damping:a.springDefaults.damping,mass:a.springDefaults.mass,isResolvedFromDuration:!1,...e};if(!c(e,u)&&c(e,l))if(e.visualDuration){const t=e.visualDuration,n=2*Math.PI/(1.2*t),r=n*n,i=2*o.clamp(.05,1,1-(e.bounce||0))*Math.sqrt(r);s={...s,mass:a.springDefaults.mass,stiffness:r,damping:i}}else{const t=r.findSpring(e);s={...s,...t,mass:a.springDefaults.mass},s.isResolvedFromDuration=!0}return s}({...m,velocity:-i.millisecondsToSeconds(m.velocity||0)}),x=q||0,S=M/(2*Math.sqrt(v*j)),T=D-g,k=i.millisecondsToSeconds(Math.sqrt(v/j)),F=Math.abs(T)<5;let G;if(d||(d=F?a.springDefaults.restSpeed.granular:a.springDefaults.restSpeed.default),p||(p=F?a.springDefaults.restDelta.granular:a.springDefaults.restDelta.default),S<1){const e=r.calcAngularFreq(k,S);G=s=>{const t=Math.exp(-S*k*s);return D-t*((x+S*k*T)/e*Math.sin(e*s)+T*Math.cos(e*s))}}else if(1===S)G=e=>D-Math.exp(-k*e)*(T+(x+k*T)*e);else{const e=k*Math.sqrt(S*S-1);G=s=>{const t=Math.exp(-S*k*s),n=Math.min(e*s,300);return D-t*((x+S*k*T)*Math.sinh(n)+e*T*Math.cosh(n))/e}}const R={calculatedDuration:b&&y||null,next:e=>{const s=G(e);if(b)h.done=e>=y;else{let t=0===e?x:0;S<1&&(t=0===e?i.secondsToMilliseconds(x):n.calcGeneratorVelocity(G,e,s));const a=Math.abs(t)<=d,r=Math.abs(D-s)<=p;h.done=a&&r}return h.value=h.done?D:s,h},toString:()=>{const t=Math.min(s.calcGeneratorDuration(R),s.maxGeneratorDuration),n=e.generateLinearEasing((e=>R.next(t*e).value),t,30);return t+"ms "+n},toTransition:()=>{}};return R}f.applyToOptions=e=>{const s=t.createGeneratorEasing(e,100,f);return e.ease=s.ease,e.duration=i.secondsToMilliseconds(s.duration),e.type="keyframes",e},exports.spring=f;
//# sourceMappingURL=index.mjs.js.map
