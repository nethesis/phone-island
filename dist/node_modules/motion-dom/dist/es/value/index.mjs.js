"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../frameloop/sync-time.mjs.js"),e=require("../frameloop/frame.mjs.js"),s=require("../../../../motion-utils/dist/es/warn-once.mjs.js"),i=require("../../../../motion-utils/dist/es/subscription-manager.mjs.js"),n=require("../../../../motion-utils/dist/es/velocity-per-second.mjs.js");class r{constructor(e,s={}){this.version="12.9.1",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(e,s=!0)=>{const i=t.time.now();this.updatedAt!==i&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(e),this.current!==this.prev&&this.events.change?.notify(this.current),s&&this.events.renderRequest?.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=s.owner}setCurrent(e){var s;this.current=e,this.updatedAt=t.time.now(),null===this.canTrackVelocity&&void 0!==e&&(this.canTrackVelocity=(s=this.current,!isNaN(parseFloat(s))))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return"production"!==process.env.NODE_ENV&&s.warnOnce(!1,'value.onChange(callback) is deprecated. Switch to value.on("change", callback).'),this.on("change",t)}on(t,s){this.events[t]||(this.events[t]=new i.SubscriptionManager);const n=this.events[t].add(s);return"change"===t?()=>{n(),e.frame.read((()=>{this.events.change.getSize()||this.stop()}))}:n}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,e){this.passiveEffect=t,this.stopPassiveEffect=e}set(t,e=!0){e&&this.passiveEffect?this.passiveEffect(t,this.updateAndNotify):this.updateAndNotify(t,e)}setWithVelocity(t,e,s){this.set(e),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-s}jump(t,e=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,e&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=t.time.now();if(!this.canTrackVelocity||void 0===this.prevFrameValue||e-this.updatedAt>30)return 0;const s=Math.min(this.updatedAt-this.prevUpdatedAt,30);return n.velocityPerSecond(parseFloat(this.current)-parseFloat(this.prevFrameValue),s)}start(t){return this.stop(),new Promise((e=>{this.hasAnimated=!0,this.animation=t(e),this.events.animationStart&&this.events.animationStart.notify()})).then((()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()}))}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}exports.MotionValue=r,exports.motionValue=function(t,e){return new r(t,e)};
//# sourceMappingURL=index.mjs.js.map
