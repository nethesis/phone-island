"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../../events/add-pointer-event.mjs.js"),e=require("../../events/event-info.mjs.js"),n=require("../../utils/distance.mjs.js"),s=require("../../../../../motion-dom/dist/es/frameloop/frame.mjs.js"),i=require("../../../../../motion-dom/dist/es/gestures/utils/is-primary-pointer.mjs.js"),o=require("../../../../../motion-utils/dist/es/pipe.mjs.js"),r=require("../../../../../motion-utils/dist/es/time-conversion.mjs.js");function a(t,e){return e?{point:e(t.point)}:t}function h(t,e){return{x:t.x-e.x,y:t.y-e.y}}function l({point:t},e){return{point:t,delta:h(t,m(e)),offset:h(t,d(e)),velocity:v(e,.1)}}function d(t){return t[0]}function m(t){return t[t.length-1]}function v(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,s=null;const i=m(t);for(;n>=0&&(s=t[n],!(i.timestamp-s.timestamp>r.secondsToMilliseconds(e)));)n--;if(!s)return{x:0,y:0};const o=r.millisecondsToSeconds(i.timestamp-s.timestamp);if(0===o)return{x:0,y:0};const a={x:(i.x-s.x)/o,y:(i.y-s.y)/o};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}exports.PanSession=class{constructor(r,h,{transformPagePoint:d,contextWindow:m,dragSnapToOrigin:v=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!this.lastMoveEvent||!this.lastMoveEventInfo)return;const t=l(this.lastMoveEventInfo,this.history),e=null!==this.startEvent,i=n.distance2D(t.offset,{x:0,y:0})>=3;if(!e&&!i)return;const{point:o}=t,{timestamp:r}=s.frameData;this.history.push({...o,timestamp:r});const{onStart:a,onMove:h}=this.handlers;e||(a&&a(this.lastMoveEvent,t),this.startEvent=this.lastMoveEvent),h&&h(this.lastMoveEvent,t)},this.handlePointerMove=(t,e)=>{this.lastMoveEvent=t,this.lastMoveEventInfo=a(e,this.transformPagePoint),s.frame.update(this.updatePoint,!0)},this.handlePointerUp=(t,e)=>{this.end();const{onEnd:n,onSessionEnd:s,resumeAnimation:i}=this.handlers;if(this.dragSnapToOrigin&&i&&i(),!this.lastMoveEvent||!this.lastMoveEventInfo)return;const o=l("pointercancel"===t.type?this.lastMoveEventInfo:a(e,this.transformPagePoint),this.history);this.startEvent&&n&&n(t,o),s&&s(t,o)},!i.isPrimaryPointer(r))return;this.dragSnapToOrigin=v,this.handlers=h,this.transformPagePoint=d,this.contextWindow=m||window;const u=a(e.extractEventInfo(r),this.transformPagePoint),{point:p}=u,{timestamp:c}=s.frameData;this.history=[{...p,timestamp:c}];const{onSessionStart:f}=h;f&&f(r,l(u,this.history)),this.removeListeners=o.pipe(t.addPointerEvent(this.contextWindow,"pointermove",this.handlePointerMove),t.addPointerEvent(this.contextWindow,"pointerup",this.handlePointerUp),t.addPointerEvent(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),s.cancelFrame(this.updatePoint)}};
//# sourceMappingURL=PanSession.mjs.js.map
