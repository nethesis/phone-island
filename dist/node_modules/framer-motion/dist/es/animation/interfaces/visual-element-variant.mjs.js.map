{"version":3,"file":"visual-element-variant.mjs.js","sources":["../../../../../../../node_modules/framer-motion/dist/es/animation/interfaces/visual-element-variant.mjs"],"sourcesContent":["import { resolveVariant } from '../../render/utils/resolve-dynamic-variants.mjs';\nimport { animateTarget } from './visual-element-target.mjs';\n\nfunction animateVariant(visualElement, variant, options = {}) {\n    const resolved = resolveVariant(visualElement, variant, options.type === \"exit\"\n        ? visualElement.presenceContext?.custom\n        : undefined);\n    let { transition = visualElement.getDefaultTransition() || {} } = resolved || {};\n    if (options.transitionOverride) {\n        transition = options.transitionOverride;\n    }\n    /**\n     * If we have a variant, create a callback that runs it as an animation.\n     * Otherwise, we resolve a Promise immediately for a composable no-op.\n     */\n    const getAnimation = resolved\n        ? () => Promise.all(animateTarget(visualElement, resolved, options))\n        : () => Promise.resolve();\n    /**\n     * If we have children, create a callback that runs all their animations.\n     * Otherwise, we resolve a Promise immediately for a composable no-op.\n     */\n    const getChildAnimations = visualElement.variantChildren && visualElement.variantChildren.size\n        ? (forwardDelay = 0) => {\n            const { delayChildren = 0, staggerChildren, staggerDirection, } = transition;\n            return animateChildren(visualElement, variant, delayChildren + forwardDelay, staggerChildren, staggerDirection, options);\n        }\n        : () => Promise.resolve();\n    /**\n     * If the transition explicitly defines a \"when\" option, we need to resolve either\n     * this animation or all children animations before playing the other.\n     */\n    const { when } = transition;\n    if (when) {\n        const [first, last] = when === \"beforeChildren\"\n            ? [getAnimation, getChildAnimations]\n            : [getChildAnimations, getAnimation];\n        return first().then(() => last());\n    }\n    else {\n        return Promise.all([getAnimation(), getChildAnimations(options.delay)]);\n    }\n}\nfunction animateChildren(visualElement, variant, delayChildren = 0, staggerChildren = 0, staggerDirection = 1, options) {\n    const animations = [];\n    const maxStaggerDuration = (visualElement.variantChildren.size - 1) * staggerChildren;\n    const generateStaggerDuration = staggerDirection === 1\n        ? (i = 0) => i * staggerChildren\n        : (i = 0) => maxStaggerDuration - i * staggerChildren;\n    Array.from(visualElement.variantChildren)\n        .sort(sortByTreeOrder)\n        .forEach((child, i) => {\n        child.notify(\"AnimationStart\", variant);\n        animations.push(animateVariant(child, variant, {\n            ...options,\n            delay: delayChildren + generateStaggerDuration(i),\n        }).then(() => child.notify(\"AnimationComplete\", variant)));\n    });\n    return Promise.all(animations);\n}\nfunction sortByTreeOrder(a, b) {\n    return a.sortNodePosition(b);\n}\n\nexport { animateVariant, sortByTreeOrder };\n"],"names":["animateVariant","visualElement","variant","options","resolved","resolveVariant","type","presenceContext","custom","undefined","transition","getDefaultTransition","transitionOverride","getAnimation","Promise","all","animateTarget","resolve","getChildAnimations","variantChildren","size","forwardDelay","delayChildren","staggerChildren","staggerDirection","animations","maxStaggerDuration","generateStaggerDuration","i","Array","from","sort","sortByTreeOrder","forEach","child","notify","push","delay","then","animateChildren","when","first","last","a","b","sortNodePosition"],"mappings":"oLAGA,SAASA,EAAeC,EAAeC,EAASC,EAAU,CAAA,GACtD,MAAMC,EAAWC,EAAAA,eAAeJ,EAAeC,EAA0B,SAAjBC,EAAQG,KAC1DL,EAAcM,iBAAiBC,YAC/BC,GACN,IAAIC,WAAEA,EAAaT,EAAcU,wBAA0B,CAAC,GAAMP,GAAY,CAAA,EAC1ED,EAAQS,qBACRF,EAAaP,EAAQS,oBAMzB,MAAMC,EAAeT,EACf,IAAMU,QAAQC,IAAIC,EAAaA,cAACf,EAAeG,EAAUD,IACzD,IAAMW,QAAQG,UAKdC,EAAqBjB,EAAckB,iBAAmBlB,EAAckB,gBAAgBC,KACpF,CAACC,EAAe,KACd,MAAMC,cAAEA,EAAgB,EAACC,gBAAEA,EAAeC,iBAAEA,GAAsBd,EAClE,OAkBZ,SAAyBT,EAAeC,EAASoB,EAAgB,EAAGC,EAAkB,EAAGC,EAAmB,EAAGrB,GAC3G,MAAMsB,EAAa,GACbC,GAAsBzB,EAAckB,gBAAgBC,KAAO,GAAKG,EAChEI,EAA+C,IAArBH,EAC1B,CAACI,EAAI,IAAMA,EAAIL,EACf,CAACK,EAAI,IAAMF,EAAqBE,EAAIL,EAU1C,OATAM,MAAMC,KAAK7B,EAAckB,iBACpBY,KAAKC,GACLC,SAAQ,CAACC,EAAON,KACjBM,EAAMC,OAAO,iBAAkBjC,GAC/BuB,EAAWW,KAAKpC,EAAekC,EAAOhC,EAAS,IACxCC,EACHkC,MAAOf,EAAgBK,EAAwBC,KAChDU,MAAK,IAAMJ,EAAMC,OAAO,oBAAqBjC,KAAU,IAEvDY,QAAQC,IAAIU,EACvB,CAlCmBc,CAAgBtC,EAAeC,EAASoB,EAAgBD,EAAcE,EAAiBC,EAAkBrB,EAAQ,EAE1H,IAAMW,QAAQG,WAKduB,KAAEA,GAAS9B,EACjB,GAAI8B,EAAM,CACN,MAAOC,EAAOC,GAAiB,mBAATF,EAChB,CAAC3B,EAAcK,GACf,CAACA,EAAoBL,GAC3B,OAAO4B,IAAQH,MAAK,IAAMI,KAC9B,CAEI,OAAO5B,QAAQC,IAAI,CAACF,IAAgBK,EAAmBf,EAAQkC,QAEvE,CAkBA,SAASL,EAAgBW,EAAGC,GACxB,OAAOD,EAAEE,iBAAiBD,EAC9B"}