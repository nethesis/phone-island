"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../../animation/interfaces/visual-element.mjs.js"),t=require("../../animation/utils/is-animation-controls.mjs.js"),i=require("../../animation/utils/is-keyframes-target.mjs.js"),n=require("../../utils/shallow-compare.mjs.js"),r=require("./get-variant-context.mjs.js"),a=require("./is-variant-label.mjs.js"),s=require("./resolve-dynamic-variants.mjs.js"),o=require("./variant-props.mjs.js");const l=[...o.variantPriorityOrder].reverse(),c=o.variantPriorityOrder.length;function u(t){return i=>Promise.all(i.map((({animation:i,options:n})=>e.animateVisualElement(t,i,n))))}function m(e,t){return"string"==typeof t?t!==e:!!Array.isArray(t)&&!n.shallowCompare(t,e)}function v(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function p(){return{animate:v(!0),whileInView:v(),whileHover:v(),whileTap:v(),whileDrag:v(),whileFocus:v(),exit:v()}}exports.checkVariantsDidChange=m,exports.createAnimationState=function(e){let o=u(e),v=p(),f=!0;const y=t=>(i,n)=>{const r=s.resolveVariant(e,n,"exit"===t?e.presenceContext?.custom:void 0);if(r){const{transition:e,transitionEnd:t,...n}=r;i={...i,...n,...t}}return i};function d(u){const{props:p}=e,d=r.getVariantContext(e.parent)||{},A=[],h=new Set;let g={},j=1/0;for(let r=0;r<c;r++){const s=l[r],o=v[s],c=void 0!==p[s]?p[s]:d[s],V=a.isVariantLabel(c),w=s===u?o.isActive:null;!1===w&&(j=r);let P=c===d[s]&&c!==p[s]&&V;if(P&&f&&e.manuallyAnimateOnMount&&(P=!1),o.protectedKeys={...g},!o.isActive&&null===w||!c&&!o.prevProp||t.isAnimationControls(c)||"boolean"==typeof c)continue;const q=m(o.prevProp,c);let x=q||s===u&&o.isActive&&!P&&V||r>j&&V,C=!1;const b=Array.isArray(c)?c:[c];let K=b.reduce(y(s),{});!1===w&&(K={});const{prevResolvedValues:O={}}=o,S={...O,...K},E=t=>{x=!0,h.has(t)&&(C=!0,h.delete(t)),o.needsAnimating[t]=!0;const i=e.getValue(t);i&&(i.liveStyle=!1)};for(const e in S){const t=K[e],r=O[e];if(g.hasOwnProperty(e))continue;let a=!1;a=i.isKeyframesTarget(t)&&i.isKeyframesTarget(r)?!n.shallowCompare(t,r):t!==r,a?null!=t?E(e):h.add(e):void 0!==t&&h.has(e)?E(e):o.protectedKeys[e]=!0}o.prevProp=c,o.prevResolvedValues=K,o.isActive&&(g={...g,...K}),f&&e.blockInitialAnimation&&(x=!1);x&&(!(P&&q)||C)&&A.push(...b.map((e=>({animation:e,options:{type:s}}))))}if(h.size){const t={};if("boolean"!=typeof p.initial){const i=s.resolveVariant(e,Array.isArray(p.initial)?p.initial[0]:p.initial);i&&i.transition&&(t.transition=i.transition)}h.forEach((i=>{const n=e.getBaseTarget(i),r=e.getValue(i);r&&(r.liveStyle=!0),t[i]=n??null})),A.push({animation:t})}let V=Boolean(A.length);return!f||!1!==p.initial&&p.initial!==p.animate||e.manuallyAnimateOnMount||(V=!1),f=!1,V?o(A):Promise.resolve()}return{animateChanges:d,setActive:function(t,i){if(v[t].isActive===i)return Promise.resolve();e.variantChildren?.forEach((e=>e.animationState?.setActive(t,i))),v[t].isActive=i;const n=d(t);for(const e in v)v[e].protectedKeys={};return n},setAnimateFunction:function(t){o=t(e)},getState:()=>v,reset:()=>{v=p(),f=!0}}};
//# sourceMappingURL=animation-state.mjs.js.map
