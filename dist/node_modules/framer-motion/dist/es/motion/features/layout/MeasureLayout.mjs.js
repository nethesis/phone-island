"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),require("../../../../../../react/jsx-runtime.js");var e=require("react"),o=require("../../../components/AnimatePresence/use-presence.mjs.js"),t=require("../../../context/LayoutGroupContext.mjs.js"),r=require("../../../context/SwitchLayoutGroupContext.mjs.js"),s=require("../../../projection/node/state.mjs.js"),i=require("../../../projection/styles/scale-border-radius.mjs.js"),n=require("../../../projection/styles/scale-box-shadow.mjs.js"),a=require("../../../projection/styles/scale-correction.mjs.js"),u=require("../../../../../../motion-dom/dist/es/frameloop/frame.mjs.js"),d=require("../../../../../../motion-dom/dist/es/frameloop/microtask.mjs.js"),p=require("../../../../../../../_virtual/jsx-runtime.js");class c extends e.Component{componentDidMount(){const{visualElement:e,layoutGroup:o,switchLayoutGroup:t,layoutId:r}=this.props,{projection:i}=e;a.addScaleCorrector(m),i&&(o.group&&o.group.add(i),t&&t.register&&r&&t.register(i),i.root.didUpdate(),i.addEventListener("animationComplete",(()=>{this.safeToRemove()})),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),s.globalProjectionState.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:o,visualElement:t,drag:r,isPresent:s}=this.props,i=t.projection;return i?(i.isPresent=s,r||e.layoutDependency!==o||void 0===o||e.isPresent!==s?i.willUpdate():this.safeToRemove(),e.isPresent!==s&&(s?i.promote():i.relegate()||u.frame.postRender((()=>{const e=i.getStack();e&&e.members.length||this.safeToRemove()}))),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),d.microtask.postRender((()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()})))}componentWillUnmount(){const{visualElement:e,layoutGroup:o,switchLayoutGroup:t}=this.props,{projection:r}=e;r&&(r.scheduleCheckAfterUnmount(),o&&o.group&&o.group.remove(r),t&&t.deregister&&t.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}const m={borderRadius:{...i.correctBorderRadius,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:i.correctBorderRadius,borderTopRightRadius:i.correctBorderRadius,borderBottomLeftRadius:i.correctBorderRadius,borderBottomRightRadius:i.correctBorderRadius,boxShadow:n.correctBoxShadow};exports.MeasureLayout=function(s){const[i,n]=o.usePresence(),a=e.useContext(t.LayoutGroupContext);return p.jsxRuntime.exports.jsx(c,{...s,layoutGroup:a,switchLayoutGroup:e.useContext(r.SwitchLayoutGroupContext),isPresent:i,safeToRemove:n})};
//# sourceMappingURL=MeasureLayout.mjs.js.map
