"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),e=require("../../animation/optimized-appear/data-id.mjs.js"),o=require("../../context/LazyContext.mjs.js"),n=require("../../context/MotionConfigContext.mjs.js"),i=require("../../context/MotionContext/index.mjs.js"),r=require("../../context/PresenceContext.mjs.js"),a=require("../../context/SwitchLayoutGroupContext.mjs.js"),s=require("../../utils/is-ref-object.mjs.js"),u=require("../../utils/use-isomorphic-effect.mjs.js"),c=require("../../../../../motion-dom/dist/es/frameloop/microtask.mjs.js");function l(t){if(t)return!1!==t.options.allowProjection?t.projection:l(t.parent)}exports.useVisualElement=function(m,p,d,f,j){const{visualElement:C}=t.useContext(i.MotionContext),x=t.useContext(o.LazyContext),y=t.useContext(r.PresenceContext),M=t.useContext(n.MotionConfigContext).reducedMotion,w=t.useRef(null);f=f||x.renderer,!w.current&&f&&(w.current=f(m,{visualState:p,parent:C,props:d,presenceContext:y,blockInitialAnimation:!!y&&!1===y.initial,reducedMotionConfig:M}));const q=w.current,g=t.useContext(a.SwitchLayoutGroupContext);!q||q.projection||!j||"html"!==q.type&&"svg"!==q.type||function(t,e,o,n){const{layoutId:i,layout:r,drag:a,dragConstraints:u,layoutScroll:c,layoutRoot:m,layoutCrossfade:p}=e;t.projection=new o(t.latestValues,e["data-framer-portal-id"]?void 0:l(t.parent)),t.projection.setOptions({layoutId:i,layout:r,alwaysMeasureLayout:Boolean(a)||u&&s.isRefObject(u),visualElement:t,animationType:"string"==typeof r?r:"both",initialPromotionConfig:n,crossfade:p,layoutScroll:c,layoutRoot:m})}(w.current,d,j,g);const S=t.useRef(!1);t.useInsertionEffect((()=>{q&&S.current&&q.update(d,y)}));const h=d[e.optimizedAppearDataAttribute],v=t.useRef(Boolean(h)&&!window.MotionHandoffIsComplete?.(h)&&window.MotionHasOptimisedAnimation?.(h));return u.useIsomorphicLayoutEffect((()=>{q&&(S.current=!0,window.MotionIsMounted=!0,q.updateFeatures(),c.microtask.render(q.render),v.current&&q.animationState&&q.animationState.animateChanges())})),t.useEffect((()=>{q&&(!v.current&&q.animationState&&q.animationState.animateChanges(),v.current&&(queueMicrotask((()=>{window.MotionHandoffMarkAsComplete?.(h)})),v.current=!1))})),q};
//# sourceMappingURL=use-visual-element.mjs.js.map
