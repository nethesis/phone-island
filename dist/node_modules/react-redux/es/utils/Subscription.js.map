{"version":3,"file":"Subscription.js","sources":["../../../../../node_modules/react-redux/es/utils/Subscription.js"],"sourcesContent":["import { getBatch } from './batch'; // encapsulates the subscription logic for connecting a component to the redux store, as\n// well as nesting subscriptions of descendant components, so that we can ensure the\n// ancestor components re-render before descendants\n\nfunction createListenerCollection() {\n  const batch = getBatch();\n  let first = null;\n  let last = null;\n  return {\n    clear() {\n      first = null;\n      last = null;\n    },\n\n    notify() {\n      batch(() => {\n        let listener = first;\n\n        while (listener) {\n          listener.callback();\n          listener = listener.next;\n        }\n      });\n    },\n\n    get() {\n      let listeners = [];\n      let listener = first;\n\n      while (listener) {\n        listeners.push(listener);\n        listener = listener.next;\n      }\n\n      return listeners;\n    },\n\n    subscribe(callback) {\n      let isSubscribed = true;\n      let listener = last = {\n        callback,\n        next: null,\n        prev: last\n      };\n\n      if (listener.prev) {\n        listener.prev.next = listener;\n      } else {\n        first = listener;\n      }\n\n      return function unsubscribe() {\n        if (!isSubscribed || first === null) return;\n        isSubscribed = false;\n\n        if (listener.next) {\n          listener.next.prev = listener.prev;\n        } else {\n          last = listener.prev;\n        }\n\n        if (listener.prev) {\n          listener.prev.next = listener.next;\n        } else {\n          first = listener.next;\n        }\n      };\n    }\n\n  };\n}\n\nconst nullListeners = {\n  notify() {},\n\n  get: () => []\n};\nexport function createSubscription(store, parentSub) {\n  let unsubscribe;\n  let listeners = nullListeners;\n\n  function addNestedSub(listener) {\n    trySubscribe();\n    return listeners.subscribe(listener);\n  }\n\n  function notifyNestedSubs() {\n    listeners.notify();\n  }\n\n  function handleChangeWrapper() {\n    if (subscription.onStateChange) {\n      subscription.onStateChange();\n    }\n  }\n\n  function isSubscribed() {\n    return Boolean(unsubscribe);\n  }\n\n  function trySubscribe() {\n    if (!unsubscribe) {\n      unsubscribe = parentSub ? parentSub.addNestedSub(handleChangeWrapper) : store.subscribe(handleChangeWrapper);\n      listeners = createListenerCollection();\n    }\n  }\n\n  function tryUnsubscribe() {\n    if (unsubscribe) {\n      unsubscribe();\n      unsubscribe = undefined;\n      listeners.clear();\n      listeners = nullListeners;\n    }\n  }\n\n  const subscription = {\n    addNestedSub,\n    notifyNestedSubs,\n    handleChangeWrapper,\n    isSubscribed,\n    trySubscribe,\n    tryUnsubscribe,\n    getListeners: () => listeners\n  };\n  return subscription;\n}"],"names":["nullListeners","notify","get","store","parentSub","unsubscribe","listeners","handleChangeWrapper","subscription","onStateChange","trySubscribe","addNestedSub","subscribe","batch","getBatch","first","last","clear","listener","callback","next","push","isSubscribed","prev","createListenerCollection","notifyNestedSubs","Boolean","tryUnsubscribe","undefined","getListeners"],"mappings":"gGAwEA,MAAMA,EAAgB,CACpBC,MAAAA,GAAW,EAEXC,IAAKA,IAAM,+BAEN,SAA4BC,EAAOC,GACxC,IAAIC,EACAC,EAAYN,EAWhB,SAASO,IACHC,EAAaC,eACfD,EAAaC,eAEjB,CAMA,SAASC,IACFL,IACHA,EAAcD,EAAYA,EAAUO,aAAaJ,GAAuBJ,EAAMS,UAAUL,GACxFD,EAnGN,WACE,MAAMO,EAAQC,EAAAA,WACd,IAAIC,EAAQ,KACRC,EAAO,KACX,MAAO,CACLC,KAAAA,GACEF,EAAQ,KACRC,EAAO,IACR,EAEDf,MAAAA,GACEY,GAAM,KACJ,IAAIK,EAAWH,EAEf,KAAOG,GACLA,EAASC,WACTD,EAAWA,EAASE,IACtB,GAEH,EAEDlB,GAAAA,GACE,IAAII,EAAY,GACZY,EAAWH,EAEf,KAAOG,GACLZ,EAAUe,KAAKH,GACfA,EAAWA,EAASE,KAGtB,OAAOd,CACR,EAEDM,SAAAA,CAAUO,GACR,IAAIG,GAAe,EACfJ,EAAWF,EAAO,CACpBG,WACAC,KAAM,KACNG,KAAMP,GASR,OANIE,EAASK,KACXL,EAASK,KAAKH,KAAOF,EAErBH,EAAQG,EAGH,WACAI,GAA0B,OAAVP,IACrBO,GAAe,EAEXJ,EAASE,KACXF,EAASE,KAAKG,KAAOL,EAASK,KAE9BP,EAAOE,EAASK,KAGdL,EAASK,KACXL,EAASK,KAAKH,KAAOF,EAASE,KAE9BL,EAAQG,EAASE,MAGvB,EAGJ,CAiCkBI,GAEhB,CAWA,MAAMhB,EAAe,CACnBG,aApCF,SAAsBO,GAEpB,OADAR,IACOJ,EAAUM,UAAUM,EAC7B,EAkCEO,iBAhCF,WACEnB,EAAUL,QACZ,EA+BEM,sBACAe,aAxBF,WACE,OAAOI,QAAQrB,EACjB,EAuBEK,eACAiB,eAfF,WACMtB,IACFA,IACAA,OAAcuB,EACdtB,EAAUW,QACVX,EAAYN,EAEhB,EASE6B,aAAcA,IAAMvB,GAEtB,OAAOE,CACT"}