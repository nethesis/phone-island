{"version":3,"file":"useLongPress.js","sources":["../../../src/utils/customHooks/useLongPress.ts"],"sourcesContent":["// Copyright (C) 2024 Nethesis S.r.l.\n// SPDX-License-Identifier: AGPL-3.0-or-later\n\nimport { useCallback, useRef, useState } from 'react'\n\nexport const useLongPress = (\n  onLongPress: (event: MouseEvent) => void,\n  onClick: () => void,\n  moved: boolean,\n  resetMoved: () => void,\n  { shouldPreventDefault = true, delay = 300 } = {},\n) => {\n  const [longPressTriggered, setLongPressTriggered] = useState<boolean>(false)\n  const timeout = useRef()\n  const target = useRef()\n\n  const start = useCallback(\n    (event) => {\n      // Reset moved callback\n      resetMoved()\n\n      if (shouldPreventDefault && event.target) {\n        event.target.addEventListener('touchend', preventDefault, {\n          passive: false,\n        })\n        // Set target element\n        target.current = event.target\n      }\n\n      // @ts-ignore\n      timeout.current = setTimeout(() => {\n        onLongPress(event)\n        setLongPressTriggered(true)\n      }, delay)\n    },\n    [onLongPress, delay, shouldPreventDefault],\n  )\n\n  const clear = useCallback(\n    (event, shouldTriggerClick = true) => {\n      timeout.current && clearTimeout(timeout.current)\n\n      shouldTriggerClick &&\n        !longPressTriggered &&\n        !moved &&\n        !isStopPropagation(target.current) &&\n        onClick()\n\n      setLongPressTriggered(false)\n\n      if (shouldPreventDefault && target.current) {\n        // @ts-ignore\n        target.current.removeEventListener('touchend', preventDefault)\n      }\n    },\n    [shouldPreventDefault, onClick, moved, longPressTriggered],\n  )\n\n  return {\n    onMouseDown: (e) => start(e),\n    onTouchStart: (e) => start(e),\n    onMouseUp: (e) => clear(e),\n    onMouseLeave: (e) => clear(e, false),\n    onTouchEnd: (e) => clear(e),\n  }\n}\n\nfunction isTouchEvent(event) {\n  return 'touches' in event\n}\n\nfunction preventDefault(event) {\n  if (!isTouchEvent(event)) return\n\n  if (event.touches.length < 2 && event.preventDefault) {\n    event.preventDefault()\n  }\n}\n\nfunction isStopPropagation(target) {\n  // Check stop propagation attribute\n  if (\n    (target && target.dataset.stopPropagation) ||\n    (target && target.parentNode && target.parentNode.dataset.stopPropagation) ||\n    (target && target.parentNode.parentNode && target.parentNode.parentNode.dataset.stopPropagation)\n  ) {\n    return true\n  }\n  return false\n}\n"],"names":["preventDefault","event","isTouchEvent","touches","length","onLongPress","onClick","moved","resetMoved","_a","_b","_c","shouldPreventDefault","_d","delay","_e","useState","longPressTriggered","setLongPressTriggered","timeout","useRef","target","start","useCallback","addEventListener","passive","current","setTimeout","clear","shouldTriggerClick","clearTimeout","dataset","stopPropagation","parentNode","isStopPropagation","removeEventListener","onMouseDown","e","onTouchStart","onMouseUp","onMouseLeave","onTouchEnd"],"mappings":"2FAuEA,SAASA,EAAeC,IAJxB,SAAsBA,GACpB,MAAO,YAAaA,CACtB,EAGOC,CAAaD,IAEdA,EAAME,QAAQC,OAAS,GAAKH,EAAMD,gBACpCC,EAAMD,gBAEV,sBAxE4B,SAC1BK,EACAC,EACAC,EACAC,EACAC,GAAA,IAAAC,OAAA,IAAAD,EAA+C,CAAE,EAAAA,EAA/CE,EAAAD,EAAAE,qBAAAA,OAAoB,IAAAD,GAAOA,EAAEE,EAAWH,EAAAI,MAAXA,OAAK,IAAAD,EAAG,IAAGA,EAEpCE,EAA8CC,EAAAA,UAAkB,GAA/DC,EAAkBF,EAAA,GAAEG,EAAqBH,EAAA,GAC1CI,EAAUC,EAAAA,SACVC,EAASD,EAAAA,SAETE,EAAQC,eACZ,SAACtB,GAECO,IAEII,GAAwBX,EAAMoB,SAChCpB,EAAMoB,OAAOG,iBAAiB,WAAYxB,EAAgB,CACxDyB,SAAS,IAGXJ,EAAOK,QAAUzB,EAAMoB,QAIzBF,EAAQO,QAAUC,YAAW,WAC3BtB,EAAYJ,GACZiB,GAAsB,EACvB,GAAEJ,EACJ,GACD,CAACT,EAAaS,EAAOF,IAGjBgB,EAAQL,EAAAA,aACZ,SAACtB,EAAO4B,QAAA,IAAAA,IAAAA,GAAyB,GAC/BV,EAAQO,SAAWI,aAAaX,EAAQO,SAExCG,IACGZ,IACAV,IAmCT,SAA2Bc,GAEzB,GACGA,GAAUA,EAAOU,QAAQC,iBACzBX,GAAUA,EAAOY,YAAcZ,EAAOY,WAAWF,QAAQC,iBACzDX,GAAUA,EAAOY,WAAWA,YAAcZ,EAAOY,WAAWA,WAAWF,QAAQC,gBAEhF,OAAO,EAET,OAAO,CACT,CA5CSE,CAAkBb,EAAOK,UAC1BpB,IAEFY,GAAsB,GAElBN,GAAwBS,EAAOK,SAEjCL,EAAOK,QAAQS,oBAAoB,WAAYnC,EAElD,GACD,CAACY,EAAsBN,EAASC,EAAOU,IAGzC,MAAO,CACLmB,YAAa,SAACC,GAAM,OAAAf,EAAMe,EAAE,EAC5BC,aAAc,SAACD,GAAM,OAAAf,EAAMe,EAAE,EAC7BE,UAAW,SAACF,GAAM,OAAAT,EAAMS,EAAE,EAC1BG,aAAc,SAACH,GAAM,OAAAT,EAAMS,GAAG,EAAM,EACpCI,WAAY,SAACJ,GAAM,OAAAT,EAAMS,EAAE,EAE/B"}